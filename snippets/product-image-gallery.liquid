{%- comment -%}
  Product Image Gallery Snippet
  
  Accepts:
  - product: {Object} Product Liquid object
  - selected_variant: {Object} Currently selected variant (optional)
{%- endcomment -%}

{%- liquid
  assign selected_variant = selected_variant | default: product.selected_or_first_available_variant
  assign featured_image = product.featured_image
  assign images = product.images
  
  if selected_variant.featured_image
    assign featured_image = selected_variant.featured_image
  endif
-%}

<div class="product-gallery" data-product-gallery>
  <div class="product-gallery__main">
    <div class="product-gallery__main-image-wrapper">
      {%- if featured_image != blank -%}
        <img
          src="{{ featured_image | image_url: width: 800 }}"
          srcset="{{ featured_image | image_url: width: 400 }} 400w,
                  {{ featured_image | image_url: width: 800 }} 800w,
                  {{ featured_image | image_url: width: 1200 }} 1200w"
          sizes="(max-width: 768px) 100vw, 506px"
          alt="{{ featured_image.alt | default: product.title | escape }}"
          class="product-gallery__main-image"
          data-main-image
          width="{{ featured_image.width }}"
          height="{{ featured_image.height }}"
          loading="eager"
        >
      {%- else -%}
        <div class="product-gallery__placeholder">
          {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
        </div>
      {%- endif -%}
    </div>
    
    {%- if images.size > 1 -%}
      <button 
        type="button" 
        class="product-gallery__nav product-gallery__nav--prev"
        data-gallery-prev
        aria-label="{{ 'products.gallery.previous_image' | t | default: 'Previous image' }}"
      >
        <svg width="7" height="7" viewBox="0 0 7 7" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3.5 0L4.5 1L2.5 3.5H6.5V4.5H2.5L4.5 7L3.5 8L0 4.5L3.5 0Z" fill="currentColor"/>
        </svg>
      </button>
      <button 
        type="button" 
        class="product-gallery__nav product-gallery__nav--next"
        data-gallery-next
        aria-label="{{ 'products.gallery.next_image' | t | default: 'Next image' }}"
      >
        <svg width="7" height="7" viewBox="0 0 7 7" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3.5 0L4.5 1L2.5 3.5H6.5V4.5H2.5L4.5 7L3.5 8L0 4.5L3.5 0Z" fill="currentColor"/>
        </svg>
      </button>
    {%- endif -%}
  </div>
  
  {%- if images.size > 1 -%}
    <div class="product-gallery__thumbnails" data-gallery-thumbnails>
      {%- for image in images limit: 5 -%}
        <button
          type="button"
          class="product-gallery__thumbnail{% if forloop.first %} product-gallery__thumbnail--active{% endif %}"
          data-thumbnail-index="{{ forloop.index0 }}"
          aria-label="{{ 'products.gallery.view_image' | t: index: forloop.index | default: 'View image' }}"
        >
          <img
            src="{{ image | image_url: width: 150 }}"
            alt="{{ image.alt | default: product.title | escape }}"
            width="74"
            height="74"
            loading="lazy"
          >
        </button>
      {%- endfor -%}
    </div>
  {%- endif -%}
</div>

{% stylesheet %}
.product-gallery {
  display: flex;
  flex-direction: column;
  gap: 19.735px;
}

.product-gallery__main {
  position: relative;
  width: 100%;
  border: 0.822px solid #e4e7e9;
  border-radius: 3.289px;
  overflow: hidden;
  background-color: var(--color-white);
}

.product-gallery__main-image-wrapper {
  position: relative;
  width: 100%;
  aspect-ratio: 506.525 / 381.538;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: var(--color-white);
}

.product-gallery__main-image {
  width: 100%;
  height: 100%;
  object-fit: contain;
  display: block;
}

.product-gallery__placeholder {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: var(--color-gray);
  min-height: 381.538px;
}

.product-gallery__placeholder svg {
  width: 60%;
  height: 60%;
  opacity: 0.5;
}

.product-gallery__nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background-color: var(--color-white);
  border: 0.645px solid var(--color-black);
  border-radius: 1.29px;
  box-shadow: 0.645px 0.645px 0px 0px var(--color-black);
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 2;
  transition: transform var(--transition-fast), box-shadow var(--transition-fast);
  padding: 6.452px;
}

.product-gallery__nav:hover {
  transform: translateY(-50%) translate(-1px, -1px);
  box-shadow: 1.645px 1.645px 0px 0px var(--color-black);
}

.product-gallery__nav:active {
  transform: translateY(-50%) translate(1px, 1px);
  box-shadow: 0.345px 0.345px 0px 0px var(--color-black);
}

.product-gallery__nav--prev {
  left: 16px;
}

.product-gallery__nav--next {
  right: 16px;
  transform: translateY(-50%) rotate(180deg);
}

.product-gallery__nav--next:hover {
  transform: translateY(-50%) rotate(180deg) translate(-1px, -1px);
}

.product-gallery__nav--next:active {
  transform: translateY(-50%) rotate(180deg) translate(1px, 1px);
}

.product-gallery__nav svg {
  width: 100%;
  height: 100%;
  color: var(--color-text);
}

.product-gallery__thumbnails {
  display: flex;
  gap: 6.157px;
  justify-content: center;
  flex-wrap: wrap;
}

.product-gallery__thumbnail {
  width: 73.887px;
  height: 73.887px;
  border: none;
  background: none;
  padding: 0;
  cursor: pointer;
  border-radius: 1.539px;
  overflow: hidden;
  position: relative;
  transition: transform var(--transition-fast);
}

.product-gallery__thumbnail:hover {
  transform: scale(1.05);
}

.product-gallery__thumbnail--active {
  outline: 2px solid var(--color-text);
  outline-offset: 2px;
}

.product-gallery__thumbnail img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

@media screen and (max-width: 768px) {
  .product-gallery {
    gap: var(--spacing-md);
  }
  
  .product-gallery__main-image-wrapper {
    aspect-ratio: 4 / 3;
  }
  
  .product-gallery__thumbnails {
    gap: var(--spacing-sm);
  }
  
  .product-gallery__thumbnail {
    width: 60px;
    height: 60px;
  }
}
{% endstylesheet %}

