{%- liquid
  assign search_query = search.terms | escape
  assign results_per_page = section.settings.results_per_page | default: 12
  assign show_product_count = section.settings.show_product_count
  assign bg_image = section.settings.background_image
-%}

<section class="search-results bg-grid-pattern"{% if bg_image != blank %} style="background-image: url('{{ bg_image | image_url: width: 1920 }}'); background-size: cover; background-position: center; background-repeat: no-repeat;"{% endif %}>
  <div class="search-results__container">
    <div class="search-results__header">
      <h1 class="search-results__title section__title">
        {%- if search.performed -%}
          {%- if search.results_count > 0 -%}
            {{ 'general.search.results_for' | t: terms: search_query }}
          {%- else -%}
            {{ 'general.search.no_results' | t: terms: search_query }}
          {%- endif -%}
        {%- else -%}
          {{ 'general.search.title' | t }}
        {%- endif -%}
      </h1>

      {%- if show_product_count and search.performed and search.results_count > 0 -%}
        <p class="search-results__count">
          {%- if search.results_count == 1 -%}
            {{ 'general.search.results_count' | t: count: search.results_count }}
          {%- else -%}
            {{ 'general.search.results_count_plural' | t: count: search.results_count }}
          {%- endif -%}
        </p>
      {%- endif -%}
    </div>

    <div class="search-results__form-wrapper">
      <form action="{{ routes.search_url }}" method="get" class="search-results__form">
        <input 
          type="search" 
          name="q" 
          class="search-results__input"
          placeholder="{{ 'general.search.placeholder' | t }}"
          aria-label="{{ 'general.search.placeholder' | t }}"
          value="{{ search_query }}"
          autocomplete="off"
        >
        <input type="hidden" name="type" value="product">
        <button type="submit" class="search-results__btn" aria-label="{{ 'general.search.submit' | t }}">
          <svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="9.5" cy="9.5" r="7.5" stroke="currentColor" stroke-width="2"/>
            <path d="M15 15L20 20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </form>
    </div>

    {%- if search.performed -%}
      {%- if search.results_count > 0 -%}
        {%- paginate search.results by results_per_page -%}
          <div class="search-results__grid">
            {%- for item in search.results -%}
              {%- if item.object_type == 'product' -%}
                {%- render 'product-card', product: item, badge_enabled: section.settings.badge_enabled, badge_text: section.settings.badge_text, badge_position: section.settings.badge_position, badge_style: section.settings.badge_style, badge_color: section.settings.badge_color, badge_text_color: section.settings.badge_text_color, show_discount: section.settings.show_discount, show_rating: section.settings.show_rating -%}
              {%- endif -%}
            {%- endfor -%}
          </div>

          {%- if paginate.pages > 1 -%}
            <div class="search-results__pagination">
              {%- if paginate.previous -%}
                <a href="{{ paginate.previous.url }}" class="search-results__pagination-link search-results__pagination-link--prev">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  {{ 'general.pagination.previous' | t }}
                </a>
              {%- endif -%}

              <span class="search-results__pagination-info">
                {{ 'general.pagination.page' | t: current: paginate.current_page, total: paginate.pages }}
              </span>

              {%- if paginate.next -%}
                <a href="{{ paginate.next.url }}" class="search-results__pagination-link search-results__pagination-link--next">
                  {{ 'general.pagination.next' | t }}
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </a>
              {%- endif -%}
            </div>
          {%- endif -%}
        {%- endpaginate -%}
      {%- else -%}
        <div class="search-results__empty">
          <p class="search-results__empty-text">
            {{ 'general.search.no_results_text' | t }}
          </p>
          <div class="search-results__suggestions">
            <p class="search-results__suggestions-title">{{ 'general.search.suggestions' | t }}</p>
            <ul class="search-results__suggestions-list">
              <li>{{ 'general.search.suggestion_1' | t }}</li>
              <li>{{ 'general.search.suggestion_2' | t }}</li>
              <li>{{ 'general.search.suggestion_3' | t }}</li>
            </ul>
          </div>
        </div>
      {%- endif -%}
    {%- else -%}
      <div class="search-results__empty">
        <p class="search-results__empty-text">
          {{ 'general.search.enter_search' | t }}
        </p>
      </div>
    {%- endif -%}
  </div>
</section>

{% stylesheet %}
.search-results {
  padding: 60px 0;
  color: rgba(177, 216, 255, 1);
  min-height: 60vh;
}

.search-results__container {
  max-width: var(--container-max);
  margin: 0 auto;
  padding: 0 var(--container-padding);
}

.search-results__header {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
  margin-bottom: 40px;
  text-align: center;
}

.search-results__title {
  margin-bottom: 0;
}

.search-results__count {
  font-family: var(--font-body);
  font-size: 16px;
  color: rgba(177, 216, 255, 0.8);
  margin: 0;
}

.search-results__form-wrapper {
  max-width: 600px;
  margin: 0 auto 54px;
}

.search-results__form {
  position: relative;
  display: flex;
  align-items: center;
}

.search-results__input {
  width: 100%;
  padding: 16px 50px 16px 20px;
  font-family: var(--font-body);
  font-size: 16px;
  color: var(--color-black);
  background-color: var(--color-white);
  border: 2px solid var(--color-black);
  border-radius: 6px;
  box-shadow: 4px 4px 0px 0px var(--color-black);
  transition: box-shadow var(--transition-fast);
}

.search-results__input:focus {
  outline: none;
  box-shadow: 6px 6px 0px 0px var(--color-black);
}

.search-results__btn {
  position: absolute;
  right: 15px;
  top: 50%;
  transform: translateY(-50%);
  padding: 0;
  width: 21px;
  height: 21px;
  background: none;
  border: none;
  cursor: pointer;
  color: var(--color-black);
  transition: color var(--transition-fast);
}

.search-results__btn:hover {
  color: var(--color-navy);
}

.search-results__btn svg {
  width: 100%;
  height: 100%;
}

.search-results__grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 37px 31px;
  margin-bottom: 40px;
}

.search-results__pagination {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 20px;
  margin-top: 40px;
  padding-top: 40px;
  border-top: 1px solid rgba(177, 216, 255, 0.2);
}

.search-results__pagination-link {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 20px;
  font-family: var(--font-heading);
  font-weight: 600;
  font-size: 14px;
  color: var(--color-black);
  background-color: var(--color-white);
  border: 2px solid var(--color-black);
  border-radius: 4px;
  box-shadow: 3px 3px 0px 0px var(--color-black);
  text-decoration: none;
  transition: transform var(--transition-fast), box-shadow var(--transition-fast);
  cursor: pointer;
}

.search-results__pagination-link:hover {
  transform: translate(-2px, -2px);
  box-shadow: 5px 5px 0px 0px var(--color-black);
}

.search-results__pagination-link:active {
  transform: translate(1px, 1px);
  box-shadow: 1px 1px 0px 0px var(--color-black);
}

.search-results__pagination-link svg {
  width: 16px;
  height: 16px;
}

.search-results__pagination-info {
  font-family: var(--font-body);
  font-size: 14px;
  color: rgba(177, 216, 255, 0.8);
}

.search-results__empty {
  text-align: center;
  padding: 60px 20px;
}

.search-results__empty-text {
  font-family: var(--font-body);
  font-size: 18px;
  color: rgba(177, 216, 255, 0.9);
  margin: 0 0 30px;
}

.search-results__suggestions {
  max-width: 500px;
  margin: 0 auto;
  padding: 30px;
  background-color: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(177, 216, 255, 0.2);
  border-radius: 6px;
}

.search-results__suggestions-title {
  font-family: var(--font-heading);
  font-weight: 600;
  font-size: 16px;
  color: rgba(177, 216, 255, 1);
  margin: 0 0 16px;
}

.search-results__suggestions-list {
  list-style: none;
  padding: 0;
  margin: 0;
  text-align: left;
}

.search-results__suggestions-list li {
  font-family: var(--font-body);
  font-size: 14px;
  color: rgba(177, 216, 255, 0.8);
  padding: 8px 0;
  padding-left: 20px;
  position: relative;
}

.search-results__suggestions-list li::before {
  content: 'â€¢';
  position: absolute;
  left: 0;
  color: rgba(177, 216, 255, 0.6);
}

@media screen and (max-width: 992px) {
  .search-results {
    padding: 40px 0;
  }

  .search-results__header {
    margin-bottom: 32px;
  }

  .search-results__form-wrapper {
    margin-bottom: 40px;
  }

  .search-results__grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
  }
}

@media screen and (max-width: 768px) {
  .search-results {
    padding: 32px 0;
  }

  .search-results__container {
    padding: 0 16px;
  }

  .search-results__header {
    gap: 12px;
    margin-bottom: 24px;
  }

  .search-results__title {
    font-size: 28px;
  }

  .search-results__form-wrapper {
    margin-bottom: 32px;
  }

  .search-results__input {
    padding: 14px 50px 14px 18px;
    font-size: 15px;
  }

  .search-results__grid {
    display: flex;
    gap: 16px;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
    padding-left: 7.5%;
    padding-right: calc(7.5% + 4px);
    padding-bottom: 4px;
  }

  .search-results__grid::-webkit-scrollbar {
    display: none;
  }

  .search-results__grid .product-card {
    flex: 0 0 85%;
    min-width: 85%;
    max-width: 85%;
    scroll-snap-align: center;
    box-shadow: 4px 4px 0px 0px var(--color-black);
  }

  .search-results__pagination {
    flex-direction: column;
    gap: 16px;
    margin-top: 32px;
    padding-top: 32px;
  }

  .search-results__pagination-info {
    order: -1;
  }

  .search-results__empty {
    padding: 40px 16px;
  }

  .search-results__empty-text {
    font-size: 16px;
  }

  .search-results__suggestions {
    padding: 24px;
  }
}

@media screen and (max-width: 576px) {
  .search-results {
    padding: 24px 0;
  }

  .search-results__container {
    padding: 0 12px;
  }

  .search-results__header {
    margin-bottom: 20px;
  }

  .search-results__title {
    font-size: 24px;
  }

  .search-results__count {
    font-size: 14px;
  }

  .search-results__form-wrapper {
    margin-bottom: 24px;
  }

  .search-results__input {
    padding: 12px 45px 12px 16px;
    font-size: 14px;
  }

  .search-results__grid {
    padding-left: 5%;
    padding-right: calc(5% + 4px);
  }

  .search-results__grid .product-card {
    flex: 0 0 90%;
    min-width: 90%;
    max-width: 90%;
  }

  .search-results__pagination-link {
    padding: 10px 16px;
    font-size: 13px;
  }

  .search-results__empty {
    padding: 32px 12px;
  }

  .search-results__empty-text {
    font-size: 15px;
    margin-bottom: 24px;
  }

  .search-results__suggestions {
    padding: 20px;
  }

  .search-results__suggestions-title {
    font-size: 15px;
    margin-bottom: 12px;
  }

  .search-results__suggestions-list li {
    font-size: 13px;
    padding: 6px 0;
    padding-left: 18px;
  }
}

@media screen and (max-width: 480px) {
  .search-results__title {
    font-size: 20px;
  }

  .search-results__input {
    font-size: 13px;
  }
}
{% endstylesheet %}

{% schema %}
{
  "name": "Search Results",
  "tag": "section",
  "class": "search-results-section",
  "settings": [
    {
      "type": "header",
      "content": "Search Settings"
    },
    {
      "type": "range",
      "id": "results_per_page",
      "label": "Results per page",
      "min": 6,
      "max": 24,
      "step": 3,
      "default": 12,
      "info": "Number of search results to display per page"
    },
    {
      "type": "checkbox",
      "id": "show_product_count",
      "label": "Show product count",
      "default": true,
      "info": "Display the number of search results found"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background Image"
    },
    {
      "type": "header",
      "content": "Product Card Settings"
    },
    {
      "type": "checkbox",
      "id": "show_discount",
      "label": "Show discount badge",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "label": "Show rating",
      "default": true
    },
    {
      "type": "header",
      "content": "Badge Settings"
    },
    {
      "type": "checkbox",
      "id": "badge_enabled",
      "label": "Badge",
      "default": true
    },
    {
      "type": "select",
      "id": "badge_style",
      "label": "Style",
      "options": [
        {
          "value": "discount",
          "label": "Discount"
        },
        {
          "value": "custom",
          "label": "Custom"
        }
      ],
      "default": "discount"
    },
    {
      "type": "text",
      "id": "badge_text",
      "label": "Text",
      "info": "Only used when style is set to Custom"
    },
    {
      "type": "select",
      "id": "badge_position",
      "label": "Position",
      "options": [
        {
          "value": "top-left",
          "label": "Top left"
        },
        {
          "value": "top-right",
          "label": "Top right"
        },
        {
          "value": "bottom-left",
          "label": "Bottom left"
        },
        {
          "value": "bottom-right",
          "label": "Bottom right"
        }
      ],
      "default": "top-left"
    },
    {
      "type": "color",
      "id": "badge_color",
      "label": "Background",
      "default": "#1E88E5"
    },
    {
      "type": "color",
      "id": "badge_text_color",
      "label": "Text",
      "default": "#FFFFFF"
    }
  ],
  "presets": [
    {
      "name": "Search Results",
      "settings": {
        "results_per_page": 12,
        "show_product_count": true
      }
    }
  ]
}
{% endschema %}
