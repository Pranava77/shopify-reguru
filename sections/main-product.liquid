{%- comment -%}
  Main Product Section
  
  Displays the complete product details page including:
  - Product image gallery
  - Product information (title, rating, price, variants)
  - Quantity selector
  - Add to cart / Buy now buttons
  - Social sharing
  - Trust badge
  - Product description tabs
{%- endcomment -%}

{%- liquid
  assign selected_variant = product.selected_or_first_available_variant
  assign current_price = selected_variant.price
  assign compare_at_price = selected_variant.compare_at_price
  
  if compare_at_price > current_price
    assign discount_percentage = compare_at_price | minus: current_price | times: 100 | divided_by: compare_at_price | round
  endif
  
  assign rating = product.metafields.reviews.rating.value | default: 4.7
  assign review_count = product.metafields.reviews.rating_count.value | default: 21671
-%}

<script type="application/json" data-product-json>
{
  "id": {{ product.id | json }},
  "variants": [
    {%- for variant in product.variants -%}
      {
        "id": {{ variant.id | json }},
        "title": {{ variant.title | json }},
        "price": {{ variant.price | json }},
        "compare_at_price": {{ variant.compare_at_price | json }},
        "available": {{ variant.available | json }},
        "options": {{ variant.options | json }}
      }{% unless forloop.last %},{% endunless %}
    {%- endfor -%}
  ]
}
</script>

<section class="main-product" data-section-id="{{ section.id }}">
  <div class="main-product__container">
    <div class="main-product__content">
      {%- comment -%} Product Image Gallery {%- endcomment -%}
      <div class="main-product__gallery">
        {%- render 'product-image-gallery', product: product, selected_variant: selected_variant -%}
      </div>
      
      {%- comment -%} Product Information {%- endcomment -%}
      <div class="main-product__info">
        <form action="{{ routes.cart_add_url }}" method="post" enctype="multipart/form-data" id="product-form-{{ section.id }}" class="product-form">
          {%- comment -%} Product Title and Rating {%- endcomment -%}
          <div class="main-product__header">
            {%- if section.settings.enable_rating -%}
              <div class="main-product__rating">
                <div class="main-product__stars">
                  {%- for i in (1..5) -%}
                    <svg 
                      class="main-product__star{% if i <= rating %} main-product__star--filled{% endif %}" 
                      width="15" 
                      height="15" 
                      viewBox="0 0 15 15" 
                      fill="none" 
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path d="M7.5 1L9.5 5H13.5L10 8L11.5 12L7.5 9.5L3.5 12L5 8L1.5 5H5.5L7.5 1Z" fill="currentColor"/>
                    </svg>
                  {%- endfor -%}
                </div>
                <span class="main-product__rating-text">{{ rating }} Star Rating</span>
                <span class="main-product__rating-count">({{ review_count | default: '21,671' }} User feedback)</span>
              </div>
            {%- endif -%}
            
            <h1 class="main-product__title">{{ product.title }}</h1>
          </div>
          
          {%- comment -%} Price and Discount {%- endcomment -%}
          <div class="main-product__price">
            <div class="main-product__price-group">
              <span class="main-product__price-current">{{ current_price | money }}</span>
              {%- if compare_at_price > current_price -%}
                <span class="main-product__price-compare">{{ compare_at_price | money }}</span>
              {%- endif -%}
            </div>
            {%- if discount_percentage -%}
              <div class="main-product__badge">
                {{ discount_percentage }}% OFF
              </div>
            {%- endif -%}
          </div>
          
          <div class="main-product__divider"></div>
          
          {%- comment -%} Variant Selectors {%- endcomment -%}
          <div class="main-product__variants">
            {%- render 'product-variant-selector', product: product, selected_variant: selected_variant, form_id: 'product-form-' | append: section.id -%}
          </div>
          
          {%- comment -%} Quantity and Buttons {%- endcomment -%}
          <div class="main-product__actions">
            <div class="main-product__quantity">
              {%- render 'product-quantity-selector', variant: selected_variant, input_id: 'quantity-' | append: section.id -%}
            </div>
            
            <button
              type="submit"
              name="add"
              class="main-product__button main-product__button--add-to-cart"
              data-add-to-cart
              data-variant-id="{{ selected_variant.id }}"
            >
              <span>Add to card</span>
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M2 2H4L4.4 4M7 13H15L19 5H5.4M7 13L5.4 4M7 13L4.7 15.3C4.3 15.7 4.6 16.5 5.1 16.5H15M15 13V16.5M15 13H12.5M15 13H17.5" stroke="#1e1a5c" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            
            <button
              type="button"
              class="main-product__button main-product__button--buy-now"
              data-buy-now
              data-variant-id="{{ selected_variant.id }}"
            >
              Buy now
            </button>
          </div>
          
          {%- comment -%} Hidden variant input {%- endcomment -%}
          <input type="hidden" name="id" value="{{ selected_variant.id }}" data-variant-id>
          
          {%- comment -%} Social Sharing {%- endcomment -%}
          {%- if section.settings.enable_social_sharing -%}
            <div class="main-product__sharing">
              <span class="main-product__sharing-label">Share product:</span>
              <div class="main-product__sharing-buttons">
                <button
                  type="button"
                  class="main-product__share-button"
                  data-share="copy"
                  aria-label="Copy link"
                >
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 8V5C8 3.89543 8.89543 3 10 3H15C16.1046 3 17 3.89543 17 5V10C17 11.1046 16.1046 12 15 12H12M8 8H5C3.89543 8 3 8.89543 3 10V15C3 16.1046 3.89543 17 5 17H10C11.1046 17 12 16.1046 12 15V12M8 8H12M8 8V12" stroke="#5F6C72" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
                <a
                  href="https://www.facebook.com/sharer/sharer.php?u={{ shop.url | append: product.url | url_param_escape }}"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="main-product__share-button"
                  aria-label="Share on Facebook"
                >
                  <svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M7.5 2.5H9.5V0.5C9.2 0.4 8.4 0.3 7.5 0.3C5.5 0.3 4 1.8 4 4V5.5H2V8H4V12.5H7V8H9.5L10 5.5H7V4C7 3.2 7.3 2.5 8.5 2.5H9.5V2.5Z" fill="#5F6C72"/>
                  </svg>
                </a>
                <a
                  href="https://twitter.com/intent/tweet?url={{ shop.url | append: product.url | url_param_escape }}&text={{ product.title | url_param_escape }}"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="main-product__share-button"
                  aria-label="Share on Twitter"
                >
                  <svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10.5 1.5H12L8 6.5L12.5 11.5H8.5L5.5 8L2.5 11.5H1L5 6.5L0.5 1.5H5L7.5 4.5L10.5 1.5ZM9.5 10.5L10.5 11.5H2.5L1.5 10.5H9.5Z" fill="#5F6C72"/>
                  </svg>
                </a>
                <a
                  href="https://pinterest.com/pin/create/button/?url={{ shop.url | append: product.url | url_param_escape }}&media={{ product.featured_image | image_url: width: 1200 | url_param_escape }}&description={{ product.title | url_param_escape }}"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="main-product__share-button"
                  aria-label="Share on Pinterest"
                >
                  <svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6.5 0C2.9 0 0 2.9 0 6.5C0 9.1 1.2 11.3 3 12.4C2.9 11.8 2.8 10.5 3.1 9.7L3.8 7.2C3.8 7.2 3.4 6.6 3.4 5.8C3.4 4.5 4.2 3.5 5.2 3.5C6 3.5 6.4 4 6.4 4.6C6.4 5.3 5.9 6.2 5.6 7C5.4 7.6 5.9 8.2 6.5 8.2C7.4 8.2 8.1 7.3 8.1 5.9C8.1 4.7 7.3 3.8 6.1 3.8C4.6 3.8 3.7 4.9 3.7 6.1C3.7 6.8 4 7.4 4.3 7.7C4.4 7.8 4.4 7.9 4.3 8L4.2 8.3C4.1 8.5 4 8.6 3.9 8.5C3.5 8.2 3.1 7.5 3.1 6.6C3.1 5 4.2 3.9 6.3 3.9C8.1 3.9 9.4 5 9.4 6.1C9.4 7.4 8.4 8.5 7 8.5C6.3 8.5 5.7 8.1 5.5 7.7L5.1 9.1C4.9 9.8 4.4 10.7 4.1 11.3C4.8 11.6 5.6 11.8 6.5 11.8C10.1 11.8 13 8.9 13 5.3C13 2.4 10.1 0 6.5 0Z" fill="#5F6C72"/>
                  </svg>
                </a>
              </div>
            </div>
          {%- endif -%}
          
          {%- comment -%} Trust Badge {%- endcomment -%}
          {%- if section.settings.enable_trust_badge -%}
            <div class="main-product__trust-badge">
              <p class="main-product__trust-text">100% Guarantee Safe Checkout</p>
              <div class="main-product__payment-methods">
                {%- comment -%} Payment method icons placeholder - can be replaced with actual payment icons {%- endcomment -%}
                <div class="main-product__payment-icons">
                  <span>Visa</span>
                  <span>Mastercard</span>
                  <span>PayPal</span>
                  <span>Amex</span>
                </div>
              </div>
            </div>
          {%- endif -%}
        </form>
      </div>
    </div>
    
    {%- comment -%} Product Description Tabs {%- endcomment -%}
    {%- if section.settings.enable_description_tabs -%}
      <div class="main-product__tabs">
        {%- render 'product-description-tabs', product: product -%}
      </div>
    {%- endif -%}
  </div>
</section>

{% stylesheet %}
.main-product {
  padding: var(--spacing-xl) 0;
  background-color: var(--color-white);
}

.main-product__container {
  max-width: var(--container-max);
  margin: 0 auto;
  padding: 0 var(--container-padding);
}

.main-product__content {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 46.048px;
  margin-bottom: var(--spacing-2xl);
  align-items: start;
}

.main-product__gallery {
  width: 100%;
}

.main-product__info {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.main-product__header {
  display: flex;
  flex-direction: column;
  gap: 6.578px;
}

.main-product__rating {
  display: flex;
  align-items: center;
  gap: 4.934px;
  flex-wrap: wrap;
}

.main-product__stars {
  display: flex;
  gap: 1.509px;
  align-items: center;
}

.main-product__star {
  width: 15.094px;
  height: 15.094px;
  color: #fa8232;
  flex-shrink: 0;
}

.main-product__star--filled {
  color: #fa8232;
}

.main-product__rating-text {
  font-family: var(--font-heading);
  font-size: 10px;
  font-weight: 600;
  line-height: 15.094px;
  color: #191c1f;
}

.main-product__rating-count {
  font-family: var(--font-heading);
  font-size: 10px;
  font-weight: 400;
  line-height: 15.094px;
  color: #5f6c72;
}

.main-product__title {
  font-family: var(--font-body);
  font-size: 18px;
  font-weight: 400;
  line-height: 23.024px;
  color: #191c1f;
  margin: 0;
}

.main-product__price {
  display: flex;
  align-items: center;
  gap: 9.867px;
  flex-wrap: wrap;
}

.main-product__price-group {
  display: flex;
  align-items: center;
  gap: 3.289px;
}

.main-product__price-current {
  font-family: var(--font-body);
  font-size: 19.735px;
  font-weight: 600;
  line-height: 26.313px;
  color: #2da5f3;
}

.main-product__price-compare {
  font-family: var(--font-body);
  font-size: 14.801px;
  font-weight: 400;
  line-height: 19.735px;
  color: #77878f;
  text-decoration: line-through;
}

.main-product__badge {
  background-color: #efd33d;
  padding: 4.111px 8.223px;
  border-radius: 2px;
  font-family: var(--font-body);
  font-size: 11.51px;
  font-weight: 600;
  line-height: 16.446px;
  color: #191c1f;
}

.main-product__divider {
  height: 1px;
  background-color: #e4e7e9;
  width: 100%;
  margin: 0;
}

.main-product__variants {
  margin: 0;
}

.main-product__actions {
  display: flex;
  gap: 13.156px;
  align-items: center;
  flex-wrap: wrap;
  padding-top: 9.867px;
}

.main-product__quantity {
  flex-shrink: 0;
}

.main-product__button {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 9.867px;
  padding: 0 26.313px;
  height: 46.048px;
  border: none;
  border-radius: 3px;
  font-family: var(--font-body);
  font-size: 13.16px;
  font-weight: 700;
  line-height: 46.048px;
  text-transform: uppercase;
  letter-spacing: 0.1579px;
  cursor: pointer;
  transition: transform var(--transition-fast), box-shadow var(--transition-fast);
  text-decoration: none;
}

.main-product__button--add-to-cart {
  background-color: var(--color-white);
  color: #151875;
  box-shadow: 4px 4px 0px 0px var(--color-navy);
  border: 1px solid var(--color-navy);
}

.main-product__button--add-to-cart:hover {
  transform: translate(-1px, -1px);
  box-shadow: 5px 5px 0px 0px var(--color-navy);
}

.main-product__button--add-to-cart:active {
  transform: translate(1px, 1px);
  box-shadow: 3px 3px 0px 0px var(--color-navy);
}

.main-product__button--buy-now {
  background-color: #1bde8f;
  color: var(--color-white);
  box-shadow: 4px 4px 0.9px 0px var(--color-navy);
}

.main-product__button--buy-now:hover {
  transform: translate(-1px, -1px);
  box-shadow: 5px 5px 0.9px 0px var(--color-navy);
}

.main-product__button--buy-now:active {
  transform: translate(1px, 1px);
  box-shadow: 3px 3px 0.9px 0px var(--color-navy);
}

.main-product__button svg {
  width: 19.735px;
  height: 19.735px;
  flex-shrink: 0;
}

.main-product__sharing {
  display: flex;
  align-items: center;
  gap: 9.867px;
  padding: 6.578px 0;
}

.main-product__sharing-label {
  font-family: var(--font-body);
  font-size: 11.512px;
  font-weight: 400;
  line-height: 16.446px;
  color: #475156;
}

.main-product__sharing-buttons {
  display: flex;
  align-items: center;
  gap: 9.867px;
}

.main-product__share-button {
  width: 19.735px;
  height: 19.735px;
  border: none;
  background: none;
  padding: 0;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #5f6c72;
  transition: transform var(--transition-fast);
}

.main-product__share-button:hover {
  transform: scale(1.1);
}

.main-product__share-button svg {
  width: 100%;
  height: 100%;
}

.main-product__trust-badge {
  background-color: var(--color-white);
  border: 1px solid #e4e7e9;
  border-radius: 3px;
  box-shadow: 4px 4px 0px 0px var(--color-navy);
  padding: 16.446px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 9.867px;
}

.main-product__trust-text {
  font-family: var(--font-body);
  font-size: 11.51px;
  font-weight: 400;
  line-height: 16.446px;
  color: #191c1f;
  text-align: center;
  margin: 0;
}

.main-product__payment-methods {
  width: 100%;
  max-width: 256.552px;
}

.main-product__payment-icons {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-sm);
  flex-wrap: wrap;
  font-size: 10px;
  color: #475156;
}

.main-product__tabs {
  margin-top: var(--spacing-2xl);
}

@media screen and (max-width: 992px) {
  .main-product__content {
    grid-template-columns: 1fr;
    gap: var(--spacing-xl);
  }
  
  .main-product__actions {
    flex-direction: column;
    align-items: stretch;
  }
  
  .main-product__button {
    width: 100%;
  }
  
  .main-product__quantity {
    width: 100%;
  }
}

@media screen and (max-width: 768px) {
  .main-product {
    padding: var(--spacing-lg) 0;
  }
  
  .main-product__content {
    gap: var(--spacing-lg);
  }
  
  .main-product__title {
    font-size: 16px;
    line-height: 1.4;
  }
  
  .main-product__price-current {
    font-size: 18px;
  }
  
  .main-product__button {
    font-size: 12px;
    padding: 0 20px;
    height: 44px;
  }
}
{% endstylesheet %}

{% schema %}
{
  "name": "Main Product",
  "tag": "section",
  "class": "main-product-section",
  "settings": [
    {
      "type": "header",
      "content": "Product Display Settings"
    },
    {
      "type": "checkbox",
      "id": "enable_rating",
      "label": "Show Rating",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_social_sharing",
      "label": "Show Social Sharing",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_trust_badge",
      "label": "Show Trust Badge",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_description_tabs",
      "label": "Show Description Tabs",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Main Product"
    }
  ]
}
{% endschema %}

