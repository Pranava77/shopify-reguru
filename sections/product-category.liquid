{%- liquid
  assign heading = section.settings.heading | default: 'Checkout our products'
  assign description = section.settings.description | default: 'Find the perfect laptop for work, play and everything in between.'
  assign background_color = section.settings.background_color | default: '#b1d8ff'
-%}

<section class="product-category" id="product-category-{{ section.id }}">
  <div class="product-category__container">
    <!-- Header Section -->
    <div class="product-category__header">
      <h2 class="product-category__heading">{{ heading }}</h2>
      {%- if description != blank -%}
        <p class="product-category__description">{{ description }}</p>
      {%- endif -%}
    </div>

    <!-- Category Cards -->
    {%- if section.blocks.size > 0 -%}
      <div class="product-category__categories" style="--category-bg: {{ background_color }};">
        {%- for block in section.blocks -%}
          {%- if block.type == 'category_card' -%}
            {%- liquid
              assign category_title = block.settings.title
              assign category_image = block.settings.image
              assign category_collection = block.settings.collection
              assign category_url = ''
              
              if category_collection != blank
                assign collection_obj = collections[category_collection]
                if collection_obj != blank
                  assign category_url = collection_obj.url
                endif
              endif
            -%}
            <div class="product-category__category-card" {{ block.shopify_attributes }}>
              {%- if category_url != blank -%}
                <a href="{{ category_url }}" class="product-category__category-link">
              {%- endif -%}
                <div class="product-category__category-image">
                  {%- if category_image != blank -%}
                    <img 
                      src="{{ category_image | image_url: width: 300 }}"
                      alt="{{ category_title | default: 'Category' }}"
                      width="300"
                      height="122"
                      loading="lazy"
                    >
                  {%- else -%}
                    <div class="product-category__category-placeholder">
                      {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
                    </div>
                  {%- endif -%}
                </div>
                <div class="product-category__category-info">
                  <p class="product-category__category-title">{{ category_title | default: 'Category' }}</p>
                </div>
              {%- if category_url != blank -%}
                </a>
              {%- endif -%}
            </div>
          {%- endif -%}
        {%- endfor -%}
      </div>
    {%- endif -%}

    <!-- Top Brands Section -->
    {%- if section.settings.show_brands and section.blocks.size > 0 -%}
      {%- assign brand_blocks = section.blocks | where: 'type', 'brand' -%}
      {%- if brand_blocks.size > 0 -%}
        <div class="product-category__brands">
          <div class="product-category__brands-header">
            <h3 class="product-category__brands-title">{{ section.settings.brands_title | default: 'Top Brands' }}</h3>
            <div class="product-category__brands-divider"></div>
          </div>
          <div class="product-category__brands-list">
            {%- for block in brand_blocks -%}
              {%- liquid
                assign brand_image = block.settings.image
                assign brand_url = block.settings.url
              -%}
              <div class="product-category__brand-item" {{ block.shopify_attributes }}>
                {%- if brand_url != blank -%}
                  <a href="{{ brand_url }}" class="product-category__brand-link">
                {%- endif -%}
                  {%- if brand_image != blank -%}
                    <img 
                      src="{{ brand_image | image_url: width: 200 }}"
                      alt="{{ block.settings.title | default: 'Brand' }}"
                      width="200"
                      height="40"
                      loading="lazy"
                    >
                  {%- else -%}
                    <span class="product-category__brand-text">{{ block.settings.title | default: 'Brand' }}</span>
                  {%- endif -%}
                {%- if brand_url != blank -%}
                  </a>
                {%- endif -%}
              </div>
            {%- endfor -%}
          </div>
        </div>
      {%- endif -%}
    {%- endif -%}

    <!-- Product Category Sections -->
    {%- assign product_category_blocks = section.blocks | where: 'type', 'product_category' -%}
    {%- if product_category_blocks.size > 0 -%}
      <div class="product-category__sections">
        {%- for block in product_category_blocks -%}
          {%- liquid
            assign category_title = block.settings.title
            assign category_collection = block.settings.collection
            assign products_to_show = block.settings.products_to_show | default: 4
            assign view_all_url = ''
            
            if category_collection != blank
              assign collection_obj = collections[category_collection]
              if collection_obj != blank
                assign view_all_url = collection_obj.url
              endif
            endif
          -%}
          <div class="product-category__section" {{ block.shopify_attributes }}>
            <div class="product-category__section-header">
              <h3 class="product-category__section-title">{{ category_title | default: 'Products' }}</h3>
              {%- if view_all_url != blank -%}
                <a href="{{ view_all_url }}" class="product-category__view-all">
                  <span>{{ block.settings.view_all_text | default: 'View all' }}</span>
                  <svg class="product-category__view-all-icon" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10 0C4.48 0 0 4.48 0 10C0 15.52 4.48 20 10 20C15.52 20 20 15.52 20 10C20 4.48 15.52 0 10 0ZM10 18C5.59 18 2 14.41 2 10C2 5.59 5.59 2 10 2C14.41 2 18 5.59 18 10C18 14.41 14.41 18 10 18ZM9 5L8 6L11 9H5V11H11L8 14L9 15L14 10L9 5Z" fill="currentColor" stroke="currentColor" stroke-width="0.5"/>
                  </svg>
                </a>
              {%- endif -%}
            </div>
            <div class="product-category__section-divider"></div>
            <div class="product-category__products">
              {%- if collection_obj != blank and collection_obj.products.size > 0 -%}
                {%- for product in collection_obj.products limit: products_to_show -%}
                  {%- render 'product-card', product: product -%}
                {%- endfor -%}
              {%- else -%}
                <p class="product-category__empty">No products available in this category.</p>
              {%- endif -%}
            </div>
          </div>
        {%- endfor -%}
      </div>
    {%- endif -%}
  </div>
</section>

{% stylesheet %}
.product-category {
  padding: 0;
  background-color: var(--color-white);
}

.product-category__container {
  max-width: var(--container-max);
  margin: 0 auto;
  padding: 0 var(--container-padding);
}

.product-category__header {
  padding: 0;
  margin-bottom: 16px;
}

.product-category__heading {
  font-family: var(--font-heading);
  font-weight: 500;
  font-size: 32px;
  line-height: normal;
  color: #272727;
  margin: 0 0 16px 0;
}

.product-category__description {
  font-family: var(--font-body);
  font-weight: 400;
  font-size: 16px;
  line-height: 64px;
  color: #4b4b4b;
  letter-spacing: -0.25px;
  margin: 0;
  max-width: 871px;
}

.product-category__categories {
  display: flex;
  gap: 24px;
  align-items: center;
  padding: 27px 0;
  background-color: var(--category-bg, #b1d8ff);
  margin: 0 calc(-1 * var(--container-padding));
  padding-left: var(--container-padding);
  padding-right: var(--container-padding);
}

.product-category__category-card {
  flex: 1 0 0;
  min-width: 0;
  background-color: #fdfdfd;
  border-radius: 8px;
  box-shadow: 8px 8px 20px 0px rgba(0, 0, 0, 0.03);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.product-category__category-link {
  display: flex;
  flex-direction: column;
  gap: 8px;
  text-decoration: none;
  color: inherit;
}

.product-category__category-image {
  width: 100%;
  height: 122px;
  overflow: hidden;
  position: relative;
}

.product-category__category-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: center;
}

.product-category__category-placeholder {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: var(--color-gray);
}

.product-category__category-placeholder svg {
  width: 60%;
  height: 60%;
  opacity: 0.5;
}

.product-category__category-info {
  display: flex;
  flex-direction: column;
  gap: 8px;
  align-items: center;
  padding: 8px 8px 16px;
}

.product-category__category-title {
  font-family: var(--font-heading);
  font-weight: 500;
  font-size: 14px;
  line-height: normal;
  color: #4b4b4b;
  text-align: center;
  margin: 0;
}

.product-category__brands {
  margin: 40px 0;
}

.product-category__brands-header {
  display: flex;
  flex-direction: column;
  gap: 16px;
  margin-bottom: 32px;
}

.product-category__brands-title {
  font-family: var(--font-product);
  font-weight: 500;
  font-size: 24px;
  line-height: normal;
  color: #272727;
  margin: 0;
}

.product-category__brands-divider {
  height: 1px;
  width: 100%;
  background-color: #e0e0e0;
}

.product-category__brands-list {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 40px;
  gap: 24px;
  flex-wrap: wrap;
}

.product-category__brand-item {
  flex-shrink: 0;
}

.product-category__brand-link {
  display: block;
  text-decoration: none;
  color: inherit;
}

.product-category__brand-item img {
  max-width: 100%;
  height: auto;
  display: block;
}

.product-category__brand-text {
  font-family: var(--font-heading);
  font-weight: 500;
  font-size: 18px;
  color: var(--color-black);
}

.product-category__sections {
  display: flex;
  flex-direction: column;
  gap: 40px;
  margin-top: 40px;
}

.product-category__section {
  display: flex;
  flex-direction: column;
  gap: 32px;
}

.product-category__section-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
}

.product-category__section-title {
  font-family: var(--font-product);
  font-weight: 500;
  font-size: 24px;
  line-height: normal;
  color: #272727;
  margin: 0;
}

.product-category__view-all {
  display: flex;
  align-items: center;
  gap: 4px;
  text-decoration: none;
  color: #1a4de1;
  font-family: var(--font-product);
  font-weight: 400;
  font-size: 16px;
  line-height: normal;
  transition: opacity var(--transition-fast);
}

.product-category__view-all:hover {
  opacity: 0.8;
}

.product-category__view-all-icon {
  width: 20px;
  height: 20px;
  flex-shrink: 0;
}

.product-category__section-divider {
  height: 1px;
  width: 100%;
  background-color: #e0e0e0;
}

.product-category__products {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 24px;
}

.product-category__empty {
  grid-column: 1 / -1;
  text-align: center;
  padding: 40px 20px;
  font-family: var(--font-body);
  font-size: 16px;
  color: var(--color-text-secondary);
}

@media screen and (max-width: 1200px) {
  .product-category__products {
    grid-template-columns: repeat(3, 1fr);
  }
}

@media screen and (max-width: 992px) {
  .product-category__heading {
    font-size: 28px;
  }

  .product-category__description {
    font-size: 14px;
    line-height: 1.5;
  }

  .product-category__categories {
    flex-wrap: wrap;
    gap: 16px;
  }

  .product-category__category-card {
    flex: 1 1 calc(50% - 8px);
    min-width: 150px;
  }

  .product-category__brands-list {
    padding: 0 20px;
    gap: 16px;
  }

  .product-category__products {
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
  }
}

@media screen and (max-width: 768px) {
  .product-category__container {
    padding: 0 16px;
  }

  .product-category__header {
    margin-bottom: 12px;
  }

  .product-category__heading {
    font-size: 24px;
  }

  .product-category__description {
    font-size: 14px;
    line-height: 1.4;
  }

  .product-category__categories {
    padding: 20px 16px;
    gap: 12px;
  }

  .product-category__category-card {
    flex: 1 1 calc(50% - 6px);
  }

  .product-category__category-image {
    height: 100px;
  }

  .product-category__category-title {
    font-size: 12px;
  }

  .product-category__brands {
    margin: 32px 0;
  }

  .product-category__brands-header {
    margin-bottom: 24px;
  }

  .product-category__brands-title {
    font-size: 20px;
  }

  .product-category__brands-list {
    padding: 0;
    justify-content: center;
  }

  .product-category__brand-item {
    flex: 0 0 auto;
  }

  .product-category__sections {
    gap: 32px;
    margin-top: 32px;
  }

  .product-category__section {
    gap: 24px;
  }

  .product-category__section-title {
    font-size: 20px;
  }

  .product-category__view-all {
    font-size: 14px;
  }

  .product-category__view-all-icon {
    width: 18px;
    height: 18px;
  }

  .product-category__products {
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
  }
}

@media screen and (max-width: 576px) {
  .product-category__container {
    padding: 0 12px;
  }

  .product-category__heading {
    font-size: 20px;
  }

  .product-category__description {
    font-size: 13px;
  }

  .product-category__categories {
    padding: 16px 12px;
    gap: 8px;
  }

  .product-category__category-card {
    flex: 1 1 100%;
  }

  .product-category__category-image {
    height: 80px;
  }

  .product-category__brands-title {
    font-size: 18px;
  }

  .product-category__section-title {
    font-size: 18px;
  }

  .product-category__products {
    grid-template-columns: 1fr;
    gap: 12px;
  }
}
{% endstylesheet %}

{% schema %}
{
  "name": "Product Category",
  "tag": "section",
  "class": "product-category-section",
  "settings": [
    {
      "type": "header",
      "content": "Header Settings"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Checkout our products"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Find the perfect laptop for work, play and everything in between."
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Category Background Color",
      "default": "#b1d8ff"
    },
    {
      "type": "header",
      "content": "Brands Settings"
    },
    {
      "type": "checkbox",
      "id": "show_brands",
      "label": "Show Brands Section",
      "default": true
    },
    {
      "type": "text",
      "id": "brands_title",
      "label": "Brands Title",
      "default": "Top Brands"
    }
  ],
  "blocks": [
    {
      "type": "category_card",
      "name": "Category Card",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Category"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection",
          "info": "Link this category to a collection"
        }
      ]
    },
    {
      "type": "brand",
      "name": "Brand",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Brand Name",
          "default": "Brand"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Brand Logo"
        },
        {
          "type": "url",
          "id": "url",
          "label": "Brand URL"
        }
      ]
    },
    {
      "type": "product_category",
      "name": "Product Category",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Category Title",
          "default": "Products"
        },
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        },
        {
          "type": "range",
          "id": "products_to_show",
          "label": "Products to Show",
          "min": 2,
          "max": 8,
          "step": 1,
          "default": 4
        },
        {
          "type": "text",
          "id": "view_all_text",
          "label": "View All Text",
          "default": "View all"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product Category",
      "settings": {
        "heading": "Checkout our products",
        "description": "Find the perfect laptop for work, play and everything in between.",
        "background_color": "#b1d8ff",
        "show_brands": true,
        "brands_title": "Top Brands"
      },
      "blocks": [
        {
          "type": "category_card",
          "settings": {
            "title": "Laptop"
          }
        },
        {
          "type": "category_card",
          "settings": {
            "title": "Monitor"
          }
        },
        {
          "type": "category_card",
          "settings": {
            "title": "Phone"
          }
        },
        {
          "type": "category_card",
          "settings": {
            "title": "Television"
          }
        },
        {
          "type": "category_card",
          "settings": {
            "title": "Headphone"
          }
        },
        {
          "type": "product_category",
          "settings": {
            "title": "Laptop",
            "products_to_show": 4
          }
        },
        {
          "type": "product_category",
          "settings": {
            "title": "Phone",
            "products_to_show": 4
          }
        },
        {
          "type": "product_category",
          "settings": {
            "title": "Television",
            "products_to_show": 4
          }
        },
        {
          "type": "product_category",
          "settings": {
            "title": "Monitor",
            "products_to_show": 4
          }
        },
        {
          "type": "product_category",
          "settings": {
            "title": "Headphone",
            "products_to_show": 4
          }
        }
      ]
    }
  ]
}
{% endschema %}
