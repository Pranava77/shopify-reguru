{%- liquid
  assign heading = section.settings.heading | default: 'Testimonials'
  assign bg_color = section.settings.background_color | default: '#B1D8FF'
  assign total_testimonials = section.blocks.size
  if total_testimonials == 0
    assign total_testimonials = 3
  endif
-%}

<section class="testimonials" style="--testimonials-bg: {{ bg_color }};" data-testimonials-section>
  <div class="testimonials__container">
    <div class="testimonials__header">
      <h2 class="testimonials__title">{{ heading }}</h2>
    </div>

    <div class="testimonials__slider">
      <div class="testimonials__track" data-testimonials-track>
        {%- for block in section.blocks -%}
          <div class="testimonials__card-wrapper{% if forloop.index > 1 %} testimonials__card--hidden-mobile{% endif %}">
            {%- render 'testimonial-card',
              name: block.settings.name,
              quote: block.settings.quote,
              image: block.settings.image
            -%}
          </div>
        {%- endfor -%}

        {%- if section.blocks.size == 0 -%}
          {%- assign default_testimonials = 'Ashok Kumar|Priyanka Sharma|gopal krishna' | split: '|' -%}
          {%- for person in default_testimonials -%}
            <div class="testimonials__card-wrapper{% if forloop.index > 1 %} testimonials__card--hidden-mobile{% endif %}">
              <article class="testimonial-card card">
                <div class="testimonial-card__quote-bg"></div>
                <div class="testimonial-card__content">
                  <div class="testimonial-card__avatar">
                    <div class="testimonial-card__avatar-placeholder">
                      <svg viewBox="0 0 80 112" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="80" height="112" rx="10" fill="#E0E0E0"/>
                        <circle cx="40" cy="35" r="20" fill="#B0B0B0"/>
                        <ellipse cx="40" cy="85" rx="30" ry="25" fill="#B0B0B0"/>
                      </svg>
                    </div>
                  </div>
                  <div class="testimonial-card__divider"></div>
                  <div class="testimonial-card__text">
                    <h3 class="testimonial-card__name">{{ person }}</h3>
                    <p class="testimonial-card__quote">"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus sit amet mi nec massa tincidunt"</p>
                  </div>
                </div>
                <div class="testimonial-card__icon">
                  <svg width="34" height="32" viewBox="0 0 34 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 16L16 0H10L2 16V32H18V16H8Z" fill="#5294FF"/>
                    <path d="M24 16L32 0H26L18 16V32H34V16H24Z" fill="#5294FF"/>
                  </svg>
                </div>
              </article>
            </div>
          {%- endfor -%}
        {%- endif -%}
      </div>
    </div>

    {%- if total_testimonials > 1 -%}
      <button type="button" class="testimonials__show-more btn btn--blue" data-testimonials-toggle aria-expanded="false">
        <span class="testimonials__show-more-text" data-show-text>Show All ({{ total_testimonials | minus: 1 }} more)</span>
        <span class="testimonials__show-less-text" data-hide-text>Show Less</span>
        <svg class="testimonials__toggle-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    {%- endif -%}

    <div class="testimonials__nav">
      <button type="button" class="testimonials__nav-btn btn btn--icon btn--blue" data-testimonial-prev aria-label="Previous testimonial">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button type="button" class="testimonials__nav-btn btn btn--icon btn--blue" data-testimonial-next aria-label="Next testimonial">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </div>
</section>

{% stylesheet %}
.testimonials {
  padding: 60px 0;
  background-color: var(--testimonials-bg);
}

.testimonials__container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 33px;
  max-width: var(--container-max);
  margin: 0 auto;
  padding: 0 var(--container-padding);
}

.testimonials__header {
  text-align: center;
}

.testimonials__title {
  font-family: var(--font-heading);
  font-weight: 600;
  font-size: 49px;
  line-height: 1.1;
  color: var(--color-dark-blue);
  text-transform: capitalize;
  margin: 0;
}

.testimonials__slider {
  width: 100%;
  max-width: 1281px;
  overflow: hidden;
}

.testimonials__track {
  display: flex;
  gap: 25px;
  transition: transform 0.4s ease;
}

.testimonials__nav {
  display: flex;
  gap: 24px;
  align-items: center;
}

.testimonials__nav-btn {
  width: 32px;
  height: 32px;
  padding: 8px;
  background-color: var(--color-blue);
  border: 1px solid var(--color-black);
  border-radius: var(--radius-sm);
  box-shadow: var(--shadow-sm);
  color: var(--color-black);
  cursor: pointer;
  transition: transform var(--transition-fast), box-shadow var(--transition-fast);
}

.testimonials__nav-btn:hover {
  transform: translate(-1px, -1px);
  box-shadow: 3px 3px 0px 0px var(--color-black);
}

.testimonials__nav-btn:active {
  transform: translate(1px, 1px);
  box-shadow: 1px 1px 0px 0px var(--color-black);
}

.testimonials__nav-btn svg {
  width: 16px;
  height: 16px;
}

@media screen and (max-width: 992px) {
  .testimonials__title {
    font-size: 36px;
  }

  .testimonials__track {
    gap: 16px;
  }
}

@media screen and (max-width: 768px) {
  .testimonials__title {
    font-size: 28px;
  }

  .testimonials__track {
    flex-direction: column;
    align-items: center;
  }

  /* Hide additional cards on mobile by default */
  .testimonials__card--hidden-mobile {
    display: none;
  }

  /* Show all cards when expanded */
  .testimonials--expanded .testimonials__card--hidden-mobile {
    display: block;
    animation: testimonialFadeIn 0.4s ease forwards;
  }

  /* Show More button - only visible on mobile */
  .testimonials__show-more {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    font-family: var(--font-heading);
    font-weight: 500;
    font-size: 14px;
    background-color: var(--color-blue);
    border: 1px solid var(--color-black);
    border-radius: var(--radius-sm);
    box-shadow: var(--shadow-sm);
    color: var(--color-black);
    cursor: pointer;
    transition: transform var(--transition-fast), box-shadow var(--transition-fast);
  }

  .testimonials__show-more:hover {
    transform: translate(-1px, -1px);
    box-shadow: 3px 3px 0px 0px var(--color-black);
  }

  .testimonials__show-more:active {
    transform: translate(1px, 1px);
    box-shadow: 1px 1px 0px 0px var(--color-black);
  }

  .testimonials__toggle-icon {
    transition: transform 0.3s ease;
  }

  .testimonials__show-more[aria-expanded="true"] .testimonials__toggle-icon {
    transform: rotate(180deg);
  }

  /* Toggle text visibility */
  .testimonials__show-less-text {
    display: none;
  }

  .testimonials__show-more[aria-expanded="true"] .testimonials__show-more-text {
    display: none;
  }

  .testimonials__show-more[aria-expanded="true"] .testimonials__show-less-text {
    display: inline;
  }

  /* Hide nav arrows on mobile */
  .testimonials__nav {
    display: none;
  }
}

/* Hide show more button on desktop */
@media screen and (min-width: 769px) {
  .testimonials__show-more {
    display: none;
  }

  .testimonials__card-wrapper {
    display: block !important;
  }
}

@keyframes testimonialFadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
{% endstylesheet %}

{% javascript %}
(function() {
  const section = document.querySelector('[data-testimonials-section]');
  if (!section) return;

  const toggleBtn = section.querySelector('[data-testimonials-toggle]');
  if (!toggleBtn) return;

  toggleBtn.addEventListener('click', function() {
    const isExpanded = this.getAttribute('aria-expanded') === 'true';
    
    // Toggle the expanded state
    this.setAttribute('aria-expanded', !isExpanded);
    section.classList.toggle('testimonials--expanded', !isExpanded);

    // Scroll to button if collapsing to ensure user sees the first card
    if (isExpanded) {
      const firstCard = section.querySelector('.testimonials__card-wrapper');
      if (firstCard) {
        firstCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }
  });
})();
{% endjavascript %}

{% schema %}
{
  "name": "Testimonials",
  "tag": "section",
  "class": "testimonials-section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Testimonials"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#B1D8FF"
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        {
          "type": "text",
          "id": "name",
          "label": "Name",
          "default": "Customer Name"
        },
        {
          "type": "textarea",
          "id": "quote",
          "label": "Quote",
          "default": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus sit amet mi nec massa tincidunt"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Customer Image"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Testimonials",
      "blocks": [
        {
          "type": "testimonial",
          "settings": {
            "name": "Ashok Kumar",
            "quote": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus sit amet mi nec massa tincidunt"
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "name": "Priyanka Sharma",
            "quote": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus sit amet mi nec massa tincidunt"
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "name": "Gopal Krishna",
            "quote": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus sit amet mi nec massa tincidunt"
          }
        }
      ]
    }
  ]
}
{% endschema %}
