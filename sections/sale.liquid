{%- liquid
  assign collection_handle = section.settings.collection
  assign collection = collections[collection_handle]
  assign products_to_show = section.settings.products_to_show | default: 12
  assign hero_image = section.settings.hero_image
  assign hero_title = section.settings.hero_title | default: 'Tech Mega Sale'
  assign hero_subtitle = section.settings.hero_subtitle | default: 'Upgrade Your Gear'
  assign hero_description = section.settings.hero_description | default: 'Save up to 40% on premium tech gear'
  assign hero_button_text = section.settings.hero_button_text | default: 'Browse Gadgets'
  assign hero_button_url = section.settings.hero_button_url
-%}

<section class="sale-section" id="sale-{{ section.id }}">
  {%- comment -%} Hero Banner {%- endcomment -%}
  {%- if hero_image != blank or hero_title != blank -%}
    <div class="sale-section__hero">
      <div class="sale-section__hero-container">
        {%- if hero_image != blank -%}
          <div class="sale-section__hero-image">
            <img 
              src="{{ hero_image | image_url: width: 1440 }}"
              alt="{{ hero_title }}"
              width="1440"
              height="411"
              loading="eager"
            >
          </div>
        {%- endif -%}
        <div class="sale-section__hero-content">
          <p class="sale-section__hero-label">{{ 'sections.sale.mega_deals_event' | t | default: 'MEGA DEALS EVENT' }}</p>
          <h1 class="sale-section__hero-title">{{ hero_title }}</h1>
          <h2 class="sale-section__hero-subtitle">{{ hero_subtitle }}</h2>
          <p class="sale-section__hero-description">{{ hero_description }}</p>
          {%- if hero_button_url != blank -%}
            <a href="{{ hero_button_url }}" class="sale-section__hero-button">
              {{ hero_button_text }}
            </a>
          {%- endif -%}
        </div>
      </div>
    </div>
  {%- endif -%}

  {%- comment -%} Main Content Area {%- endcomment -%}
  <div class="sale-section__container">
    <div class="sale-section__layout">
      {%- comment -%} Filter Sidebar {%- endcomment -%}
      <aside class="sale-section__filters" data-sale-filters>
        <div class="sale-section__filters-header">
          <h3 class="sale-section__filters-title">{{ 'sections.sale.filters' | t | default: 'Filters' }}</h3>
          <button type="button" class="sale-section__filters-toggle" data-filters-toggle aria-label="Toggle filters">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>

        {%- comment -%} Price Filter {%- endcomment -%}
        <div class="sale-section__filter-group">
          <div class="sale-section__filter-header">
            <h4 class="sale-section__filter-title">{{ 'sections.sale.price' | t | default: 'Price' }}</h4>
            <button type="button" class="sale-section__filter-toggle" data-filter-toggle="price" aria-label="Toggle price filter">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
          <div class="sale-section__filter-content" data-filter-content="price">
            <div class="sale-section__price-inputs">
              <input 
                type="text" 
                class="sale-section__price-input" 
                id="price-min-{{ section.id }}"
                data-price-min
              >
              <span class="sale-section__price-separator">{{ 'sections.sale.to' | t | default: 'To' }}</span>
              <input 
                type="text" 
                class="sale-section__price-input" 
                id="price-max-{{ section.id }}"
                data-price-max
              >
            </div>
            <div class="sale-section__price-slider" data-price-slider>
              <input 
                type="range" 
                class="sale-section__slider sale-section__slider--min" 
                min="0" 
                max="100000" 
                value="0"
                data-slider-min
              >
              <input 
                type="range" 
                class="sale-section__slider sale-section__slider--max" 
                min="0" 
                max="100000" 
                value="100000"
                data-slider-max
              >
            </div>
          </div>
        </div>

        {%- comment -%} Category Filter {%- endcomment -%}
        {%- if section.blocks.size > 0 -%}
          {%- assign category_blocks = section.blocks | where: 'type', 'category' -%}
          {%- if category_blocks.size > 0 -%}
            <div class="sale-section__filter-group">
              <div class="sale-section__filter-header">
                <h4 class="sale-section__filter-title">{{ 'sections.sale.category' | t | default: 'Category' }}</h4>
                <button type="button" class="sale-section__filter-toggle" data-filter-toggle="category" aria-label="Toggle category filter">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
              <div class="sale-section__filter-content" data-filter-content="category">
                {%- for block in category_blocks -%}
                  <label class="sale-section__filter-checkbox">
                    <input 
                      type="checkbox" 
                      value="{{ block.settings.value | default: block.settings.label | handleize }}"
                      data-filter-category
                      {{ block.shopify_attributes }}
                    >
                    <span class="sale-section__filter-checkbox-label">{{ block.settings.label | default: 'Category' }}</span>
                  </label>
                {%- endfor -%}
              </div>
            </div>
          {%- endif -%}
        {%- endif -%}

        {%- comment -%} Brand Filter {%- endcomment -%}
        {%- if section.blocks.size > 0 -%}
          {%- assign brand_blocks = section.blocks | where: 'type', 'brand' -%}
          {%- if brand_blocks.size > 0 -%}
            <div class="sale-section__filter-group">
              <div class="sale-section__filter-header">
                <h4 class="sale-section__filter-title">{{ 'sections.sale.brand' | t | default: 'Brand' }}</h4>
                <button type="button" class="sale-section__filter-toggle" data-filter-toggle="brand" aria-label="Toggle brand filter">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
              <div class="sale-section__filter-content" data-filter-content="brand">
                {%- for block in brand_blocks -%}
                  <label class="sale-section__filter-checkbox">
                    <input 
                      type="checkbox" 
                      value="{{ block.settings.value | default: block.settings.label | handleize }}"
                      data-filter-brand
                      {{ block.shopify_attributes }}
                    >
                    <span class="sale-section__filter-checkbox-label">
                      {{ block.settings.label | default: 'Brand' }}
                      {%- if block.settings.count != blank -%}
                        <span class="sale-section__filter-count">({{ block.settings.count }})</span>
                      {%- endif -%}
                    </span>
                  </label>
                {%- endfor -%}
              </div>
            </div>
          {%- endif -%}
        {%- endif -%}
      </aside>

      {%- comment -%} Product Grid {%- endcomment -%}
      <div class="sale-section__products">
        {%- comment -%} Mobile Filter Button {%- endcomment -%}
        <button type="button" class="sale-section__filter-trigger" data-filter-drawer-trigger aria-label="Open filters">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M2 4H18M5 10H15M8 16H12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <span>Filters</span>
        </button>
        <div class="sale-section__carousel-wrapper">
          <div class="sale-section__carousel" data-sale-carousel>
            <div class="sale-section__products-grid" data-products-grid data-carousel-track>
              {%- if collection != blank and collection.products.size > 0 -%}
                {%- for product in collection.products limit: products_to_show -%}
                  {%- render 'product-card', product: product, show_discount: true, show_rating: true -%}
                {%- endfor -%}
              {%- else -%}
                <p class="sale-section__empty">{{ 'sections.sale.no_products' | t | default: 'No products available.' }}</p>
              {%- endif -%}
            </div>
          </div>
        </div>
      </div>
    </div>

    {%- comment -%} Join Franchise Button {%- endcomment -%}
    {%- if section.settings.show_franchise_button -%}
      <div class="sale-section__franchise">
        <a href="{{ section.settings.franchise_url | default: '/pages/franchise' }}" class="sale-section__franchise-button">
          {{ section.settings.franchise_text | default: 'Join Franchise' }}
        </a>
      </div>
    {%- endif -%}
  </div>

  {%- comment -%} Mobile Filter Drawer {%- endcomment -%}
  <div class="sale-section__filter-drawer" data-filter-drawer aria-hidden="true">
    <div class="sale-section__filter-overlay" data-filter-overlay></div>
    <div class="sale-section__filter-panel" data-filter-panel>
      <div class="sale-section__filter-drawer-header">
        <h3 class="sale-section__filter-drawer-title">{{ 'sections.sale.filters' | t | default: 'Filters' }}</h3>
        <button type="button" class="sale-section__filter-drawer-close" data-filter-drawer-close aria-label="Close filters">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 4L20 20M20 4L4 20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
      <div class="sale-section__filter-drawer-content">
        {%- comment -%} Price Filter {%- endcomment -%}
        <div class="sale-section__filter-group">
          <div class="sale-section__filter-header">
            <h4 class="sale-section__filter-title">{{ 'sections.sale.price' | t | default: 'Price' }}</h4>
            <button type="button" class="sale-section__filter-toggle" data-filter-toggle="price-drawer" aria-label="Toggle price filter" aria-expanded="true">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
          <div class="sale-section__filter-content" data-filter-content="price-drawer">
            <div class="sale-section__price-inputs">
              <input 
                type="text" 
                class="sale-section__price-input" 
                id="price-min-drawer-{{ section.id }}"
                data-price-min-drawer
              >
              <span class="sale-section__price-separator">{{ 'sections.sale.to' | t | default: 'To' }}</span>
              <input 
                type="text" 
                class="sale-section__price-input" 
                id="price-max-drawer-{{ section.id }}"
                data-price-max-drawer
              >
            </div>
            <div class="sale-section__price-slider" data-price-slider-drawer>
              <input 
                type="range" 
                class="sale-section__slider sale-section__slider--min" 
                min="0" 
                max="100000" 
                value="0"
                data-slider-min-drawer
              >
              <input 
                type="range" 
                class="sale-section__slider sale-section__slider--max" 
                min="0" 
                max="100000" 
                value="100000"
                data-slider-max-drawer
              >
            </div>
          </div>
        </div>

        {%- comment -%} Category Filter {%- endcomment -%}
        {%- if section.blocks.size > 0 -%}
          {%- assign category_blocks = section.blocks | where: 'type', 'category' -%}
          {%- if category_blocks.size > 0 -%}
            <div class="sale-section__filter-group">
              <div class="sale-section__filter-header">
                <h4 class="sale-section__filter-title">{{ 'sections.sale.category' | t | default: 'Category' }}</h4>
                <button type="button" class="sale-section__filter-toggle" data-filter-toggle="category-drawer" aria-label="Toggle category filter" aria-expanded="true">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
              <div class="sale-section__filter-content" data-filter-content="category-drawer">
                {%- for block in category_blocks -%}
                  <label class="sale-section__filter-checkbox">
                    <input 
                      type="checkbox" 
                      value="{{ block.settings.value | default: block.settings.label | handleize }}"
                      data-filter-category-drawer
                      {{ block.shopify_attributes }}
                    >
                    <span class="sale-section__filter-checkbox-label">{{ block.settings.label | default: 'Category' }}</span>
                  </label>
                {%- endfor -%}
              </div>
            </div>
          {%- endif -%}
        {%- endif -%}

        {%- comment -%} Brand Filter {%- endcomment -%}
        {%- if section.blocks.size > 0 -%}
          {%- assign brand_blocks = section.blocks | where: 'type', 'brand' -%}
          {%- if brand_blocks.size > 0 -%}
            <div class="sale-section__filter-group">
              <div class="sale-section__filter-header">
                <h4 class="sale-section__filter-title">{{ 'sections.sale.brand' | t | default: 'Brand' }}</h4>
                <button type="button" class="sale-section__filter-toggle" data-filter-toggle="brand-drawer" aria-label="Toggle brand filter" aria-expanded="true">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
              <div class="sale-section__filter-content" data-filter-content="brand-drawer">
                {%- for block in brand_blocks -%}
                  <label class="sale-section__filter-checkbox">
                    <input 
                      type="checkbox" 
                      value="{{ block.settings.value | default: block.settings.label | handleize }}"
                      data-filter-brand-drawer
                      {{ block.shopify_attributes }}
                    >
                    <span class="sale-section__filter-checkbox-label">
                      {{ block.settings.label | default: 'Brand' }}
                      {%- if block.settings.count != blank -%}
                        <span class="sale-section__filter-count">({{ block.settings.count }})</span>
                      {%- endif -%}
                    </span>
                  </label>
                {%- endfor -%}
              </div>
            </div>
          {%- endif -%}
        {%- endif -%}
      </div>
      <div class="sale-section__filter-drawer-footer">
        <button type="button" class="sale-section__filter-apply" data-filter-apply>Apply Filters</button>
        <button type="button" class="sale-section__filter-clear" data-filter-clear>Clear All</button>
      </div>
    </div>
  </div>
</section>

{% stylesheet %}
.sale-section {
  padding: 0;
  background-color: var(--color-white);
  width: 100%;
  max-width: 100%;
  overflow-x: hidden;
  box-sizing: border-box;
  position: relative;
}

.sale-section * {
  box-sizing: border-box;
}

.sale-section__hero {
  position: relative;
  margin-bottom: 40px;
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
}

.sale-section__hero-container {
  position: relative;
  width: 100%;
  max-width: 1194px;
  margin: 0 auto;
  border-radius: 12px;
  overflow: hidden;
  box-sizing: border-box;
}

.sale-section__hero-image {
  width: 100%;
  height: 411px;
  overflow: hidden;
}

.sale-section__hero-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: center;
}

.sale-section__hero-content {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 40px;
  text-align: center;
  background: linear-gradient(180deg, rgba(30, 26, 92, 0.8) 0%, rgba(4, 28, 102, 0.6) 100%);
  color: var(--color-white);
  width: 100%;
  box-sizing: border-box;
}

.sale-section__hero-label {
  font-family: var(--font-mono);
  font-weight: 700;
  font-size: 14px;
  line-height: 1;
  letter-spacing: 0.84px;
  text-transform: uppercase;
  margin: 0 0 16px 0;
  color: var(--color-white);
}

.sale-section__hero-title {
  font-family: var(--font-heading);
  font-weight: 700;
  font-size: 48px;
  line-height: 1.2;
  margin: 0 0 12px 0;
  color: var(--color-white);
  word-wrap: break-word;
  overflow-wrap: break-word;
}

.sale-section__hero-subtitle {
  font-family: var(--font-heading);
  font-weight: 700;
  font-size: 64px;
  line-height: 1.1;
  margin: 0 0 16px 0;
  color: var(--color-blue);
  word-wrap: break-word;
  overflow-wrap: break-word;
}

.sale-section__hero-description {
  font-family: var(--font-body);
  font-weight: 400;
  font-size: 18px;
  line-height: 1.5;
  margin: 0 0 32px 0;
  color: var(--color-white);
}

.sale-section__hero-button {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 16px 32px;
  font-family: var(--font-mono);
  font-weight: 700;
  font-size: 16px;
  line-height: 1;
  color: var(--color-black);
  background-color: var(--color-blue);
  border: 2px solid var(--color-black);
  border-radius: var(--radius-sm);
  box-shadow: var(--shadow-md);
  text-decoration: none;
  transition: transform var(--transition-fast), box-shadow var(--transition-fast);
}

.sale-section__hero-button:hover {
  transform: translate(-2px, -2px);
  box-shadow: var(--shadow-lg);
}

.sale-section__hero-button:active {
  transform: translate(2px, 2px);
  box-shadow: var(--shadow-xs);
}

.sale-section__container {
  max-width: var(--container-max);
  margin: 0 auto;
  padding: 0 var(--container-padding);
  width: 100%;
  box-sizing: border-box;
  overflow-x: hidden;
}

.sale-section__layout {
  display: grid;
  grid-template-columns: 280px 1fr;
  gap: 40px;
  margin-bottom: 40px;
  align-items: start;
  width: 100%;
  box-sizing: border-box;
}

.sale-section__filters {
  position: sticky;
  top: 100px;
  background-color: var(--color-white);
  height: fit-content;
}

.sale-section__filters-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 24px;
}

.sale-section__filters-title {
  font-family: var(--font-heading);
  font-weight: 500;
  font-size: 16px;
  line-height: normal;
  color: var(--color-black);
  margin: 0;
}

.sale-section__filters-toggle {
  display: none;
  background: none;
  border: none;
  cursor: pointer;
  padding: 4px;
  color: #272727;
}

.sale-section__filter-group {
  display: flex;
  flex-direction: column;
  gap: 16px;
  padding-bottom: 24px;
  border-bottom: 1px solid #e0e0e0;
}

.sale-section__filter-group:last-child {
  border-bottom: none;
}

.sale-section__filter-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
}

.sale-section__filter-title {
  font-family: var(--font-heading);
  font-weight: 500;
  font-size: 16px;
  line-height: normal;
  color: var(--color-black);
  margin: 0;
}

.sale-section__filter-toggle {
  background: none;
  border: none;
  cursor: pointer;
  padding: 4px;
  color: var(--color-black);
  transform: rotate(180deg);
  transition: transform var(--transition-fast);
  flex-shrink: 0;
}

.sale-section__filter-toggle svg {
  width: 16px;
  height: 16px;
  transition: transform var(--transition-fast);
}

.sale-section__filter-toggle[aria-expanded="false"] {
  transform: rotate(0deg);
}

.sale-section__filter-content {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.sale-section__filter-content[hidden] {
  display: none;
}

.sale-section__price-inputs {
  display: flex;
  align-items: center;
  gap: 8px;
}

.sale-section__price-input {
  width: 116px;
  padding: 8px 12px;
  font-family: var(--font-body);
  font-size: 14px;
  border: 1px solid var(--color-black);
  border-radius: 4px;
  background-color: var(--color-white);
}

.sale-section__price-separator {
  font-family: var(--font-body);
  font-size: 14px;
  color: var(--color-black);
}

.sale-section__price-slider {
  position: relative;
  height: 4px;
  background-color: #e0e0e0;
  border-radius: 2px;
  margin-top: 8px;
}

.sale-section__slider {
  position: absolute;
  width: 100%;
  height: 4px;
  -webkit-appearance: none;
  appearance: none;
  background: transparent;
  pointer-events: none;
}

.sale-section__slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 16px;
  height: 16px;
  background-color: var(--color-blue);
  border: 2px solid var(--color-black);
  border-radius: 50%;
  cursor: pointer;
  pointer-events: all;
  box-shadow: 2px 2px 0px 0px var(--color-black);
}

.sale-section__slider::-moz-range-thumb {
  width: 16px;
  height: 16px;
  background-color: var(--color-blue);
  border: 2px solid var(--color-black);
  border-radius: 50%;
  cursor: pointer;
  pointer-events: all;
  box-shadow: 2px 2px 0px 0px var(--color-black);
}

.sale-section__slider--min {
  z-index: 2;
}

.sale-section__slider--max {
  z-index: 1;
}

.sale-section__filter-checkbox {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
}

.sale-section__filter-checkbox input[type="checkbox"] {
  width: 18px;
  height: 18px;
  cursor: pointer;
  accent-color: var(--color-blue);
  border: 1px solid var(--color-black);
}

.sale-section__filter-checkbox-label {
  font-family: var(--font-body);
  font-size: 14px;
  color: var(--color-black);
  display: flex;
  align-items: center;
  gap: 4px;
}

.sale-section__filter-count {
  font-size: 12px;
  color: var(--color-text-secondary);
}

.sale-section__products {
  flex: 1;
}

.sale-section__carousel-wrapper {
  position: relative;
}

.sale-section__carousel {
  position: relative;
  overflow: hidden;
  padding-bottom: 4px;
  padding-right: 4px;
}

.sale-section__products-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 18px;
  transition: transform 0.3s ease-in-out;
  margin-bottom: 4px;
}

/* Carousel Navigation Buttons - Removed */

.sale-section__empty {
  grid-column: 1 / -1;
  text-align: center;
  padding: 60px 20px;
  font-family: var(--font-body);
  font-size: 18px;
  color: var(--color-text-secondary);
}

.sale-section__franchise {
  display: flex;
  justify-content: center;
  margin-top: 40px;
  padding-bottom: 40px;
}

.sale-section__franchise-button {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 12px 31px;
  font-family: var(--font-product);
  font-weight: 500;
  font-size: 21px;
  line-height: 29px;
  color: var(--color-black);
  background-color: var(--color-white);
  border: 0.736px solid var(--color-black);
  border-radius: var(--radius-sm);
  box-shadow: 4.417px 4.417px 0px 0px var(--color-black);
  text-decoration: none;
  transition: transform var(--transition-fast), box-shadow var(--transition-fast);
}

.sale-section__franchise-button:hover {
  transform: translate(-2px, -2px);
  box-shadow: 6px 6px 0px 0px var(--color-black);
}

.sale-section__franchise-button:active {
  transform: translate(2px, 2px);
  box-shadow: 2px 2px 0px 0px var(--color-black);
}

/* Mobile Filter Trigger Button */
.sale-section__filter-trigger {
  display: none;
  align-items: center;
  gap: 8px;
  padding: 12px 20px;
  margin-bottom: 20px;
  font-family: var(--font-heading);
  font-weight: 500;
  font-size: 16px;
  line-height: 1;
  color: var(--color-black);
  background-color: var(--color-white);
  border: 2px solid var(--color-black);
  border-radius: var(--radius-sm);
  box-shadow: var(--shadow-md);
  cursor: pointer;
  transition: transform var(--transition-fast), box-shadow var(--transition-fast);
  width: 100%;
  justify-content: center;
}

.sale-section__filter-trigger:hover {
  transform: translate(-2px, -2px);
  box-shadow: var(--shadow-lg);
}

.sale-section__filter-trigger:active {
  transform: translate(2px, 2px);
  box-shadow: var(--shadow-xs);
}

.sale-section__filter-trigger svg {
  width: 20px;
  height: 20px;
  flex-shrink: 0;
}

/* Mobile Filter Drawer */
.sale-section__filter-drawer {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 9999;
  pointer-events: none;
  display: none;
  visibility: hidden;
}

@media screen and (max-width: 768px) {
  .sale-section__filter-drawer {
    display: block;
  }
}

.sale-section__filter-drawer[aria-hidden="false"] {
  display: block;
  visibility: visible;
  pointer-events: all;
}

.sale-section__filter-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  opacity: 0;
  transition: opacity var(--transition-base);
}

.sale-section__filter-drawer[aria-hidden="false"] .sale-section__filter-overlay {
  opacity: 1;
}

.sale-section__filter-panel {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  width: 100%;
  max-width: 400px;
  background-color: var(--color-white);
  box-shadow: -4px 0 20px rgba(0, 0, 0, 0.1);
  transform: translateX(100%);
  transition: transform 0.3s ease-in-out;
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  will-change: transform;
}

.sale-section__filter-drawer[aria-hidden="false"] .sale-section__filter-panel {
  transform: translateX(0);
}

.sale-section__filter-drawer-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 20px;
  border-bottom: 1px solid #e0e0e0;
  flex-shrink: 0;
  position: sticky;
  top: 0;
  background-color: var(--color-white);
  z-index: 1;
}

.sale-section__filter-drawer-title {
  font-family: var(--font-heading);
  font-weight: 500;
  font-size: 20px;
  line-height: normal;
  color: var(--color-black);
  margin: 0;
}

.sale-section__filter-drawer-close {
  background: none;
  border: none;
  cursor: pointer;
  padding: 8px;
  color: var(--color-black);
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: 44px;
  min-height: 44px;
  border-radius: 4px;
  transition: background-color var(--transition-fast);
}

.sale-section__filter-drawer-close:hover {
  background-color: #f5f5f5;
}

.sale-section__filter-drawer-close svg {
  width: 24px;
  height: 24px;
}

.sale-section__filter-drawer-content {
  flex: 1;
  padding: 20px;
  overflow-y: auto;
}

.sale-section__filter-drawer-footer {
  display: flex;
  gap: 12px;
  padding: 20px;
  border-top: 1px solid #e0e0e0;
  flex-shrink: 0;
  position: sticky;
  bottom: 0;
  background-color: var(--color-white);
  z-index: 1;
}

.sale-section__filter-apply,
.sale-section__filter-clear {
  flex: 1;
  padding: 14px 20px;
  font-family: var(--font-heading);
  font-weight: 500;
  font-size: 16px;
  line-height: 1;
  text-align: center;
  border: 2px solid var(--color-black);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: transform var(--transition-fast), box-shadow var(--transition-fast);
  min-height: 44px;
}

.sale-section__filter-apply {
  color: var(--color-white);
  background-color: var(--color-navy);
  box-shadow: var(--shadow-md);
}

.sale-section__filter-apply:hover {
  transform: translate(-2px, -2px);
  box-shadow: var(--shadow-lg);
}

.sale-section__filter-apply:active {
  transform: translate(2px, 2px);
  box-shadow: var(--shadow-xs);
}

.sale-section__filter-clear {
  color: var(--color-black);
  background-color: var(--color-white);
  box-shadow: var(--shadow-sm);
}

.sale-section__filter-clear:hover {
  transform: translate(-2px, -2px);
  box-shadow: var(--shadow-md);
}

.sale-section__filter-clear:active {
  transform: translate(2px, 2px);
  box-shadow: 1px 1px 0px 0px var(--color-black);
}

/* Initialize filter toggles as expanded */
.sale-section__filter-toggle {
  transform: rotate(180deg);
}

.sale-section__filter-toggle[aria-expanded="false"] {
  transform: rotate(0deg);
}

@media screen and (max-width: 1200px) {
  .sale-section__layout {
    grid-template-columns: 240px 1fr;
    gap: 32px;
    width: 100%;
    max-width: 100%;
  }

  .sale-section__products-grid {
    grid-template-columns: repeat(3, 1fr);
    display: grid;
    width: 100%;
    max-width: 100%;
  }
}

@media screen and (max-width: 992px) {
  .sale-section__layout {
    grid-template-columns: 1fr;
    gap: 24px;
    width: 100%;
    max-width: 100%;
  }

  .sale-section__filters {
    position: relative;
    top: 0;
    width: 100%;
    max-width: 100%;
  }

  .sale-section__filters-toggle {
    display: block;
  }

  .sale-section__filters[data-filters-collapsed="true"] .sale-section__filter-group {
    display: none;
  }

  .sale-section__products {
    width: 100%;
    max-width: 100%;
  }

  .sale-section__products-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    display: grid;
    width: 100%;
    max-width: 100%;
  }

  .sale-section__hero-title {
    font-size: 36px;
  }

  .sale-section__hero-subtitle {
    font-size: 48px;
  }
}

@media screen and (max-width: 768px) {
  .sale-section__container {
    padding: 0 16px;
    max-width: 100%;
  }

  .sale-section__hero {
    margin-bottom: 24px;
    padding: 0 16px;
  }

  .sale-section__hero-container {
    max-width: 100%;
    border-radius: 8px;
  }

  .sale-section__hero-image {
    height: 280px;
  }

  .sale-section__hero-content {
    padding: 20px 16px;
  }

  .sale-section__hero-title {
    font-size: 24px;
    line-height: 1.3;
  }

  .sale-section__hero-subtitle {
    font-size: 32px;
    line-height: 1.2;
  }

  .sale-section__hero-description {
    font-size: 14px;
    line-height: 1.4;
    margin: 0 0 20px 0;
  }

  .sale-section__hero-button {
    padding: 10px 20px;
    font-size: 13px;
  }

  /* Hide desktop filters on mobile */
  .sale-section__filters {
    display: none;
  }

  /* Show mobile filter trigger button */
  .sale-section__filter-trigger {
    display: flex;
  }

  .sale-section__products {
    position: relative;
  }

  .sale-section__carousel {
    overflow: visible;
    padding-bottom: 4px;
    padding-right: 0;
  }

  .sale-section__products {
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
  }

  .sale-section__carousel-wrapper {
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
  }

  .sale-section__products-grid {
    display: flex;
    gap: 16px;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
    padding-left: 7.5%;
    padding-right: calc(7.5% + 4px);
    padding-bottom: 4px;
    width: 100%;
    box-sizing: border-box;
  }

  .sale-section__products-grid::-webkit-scrollbar {
    display: none;
  }

  .sale-section__products-grid .product-card {
    flex: 0 0 85%;
    min-width: 85%;
    max-width: 85%;
    scroll-snap-align: center;
    box-shadow: 4px 4px 0px 0px var(--color-black);
  }


  .sale-section__franchise-button {
    padding: 10px 24px;
    font-size: 18px;
  }

  /* Mobile drawer panel width */
  .sale-section__filter-panel {
    max-width: 85%;
  }

  .sale-section__filter-drawer-header {
    padding: 16px;
  }

  .sale-section__filter-drawer-title {
    font-size: 18px;
  }

  .sale-section__filter-drawer-content {
    padding: 16px;
  }

  .sale-section__filter-group {
    padding-bottom: 20px;
    gap: 12px;
  }

  .sale-section__filter-title {
    font-size: 15px;
  }

  .sale-section__price-input {
    width: 100px;
    padding: 10px 12px;
    font-size: 14px;
  }

  .sale-section__filter-checkbox {
    min-height: 44px;
    padding: 8px 0;
  }

  .sale-section__filter-checkbox input[type="checkbox"] {
    width: 20px;
    height: 20px;
    min-width: 20px;
    min-height: 20px;
  }

  .sale-section__filter-drawer-footer {
    padding: 16px;
    gap: 10px;
  }

  .sale-section__filter-apply,
  .sale-section__filter-clear {
    padding: 12px 16px;
    font-size: 15px;
  }
}

@media screen and (max-width: 576px) {
  .sale-section__container {
    padding: 0 12px;
    max-width: 100%;
  }

  .sale-section__hero {
    margin-bottom: 20px;
    padding: 0 12px;
  }

  .sale-section__hero-container {
    max-width: 100%;
    border-radius: 6px;
  }

  .sale-section__hero-image {
    height: 240px;
  }

  .sale-section__hero-content {
    padding: 16px 12px;
  }

  .sale-section__hero-label {
    font-size: 12px;
    margin: 0 0 12px 0;
  }

  .sale-section__hero-title {
    font-size: 20px;
    line-height: 1.3;
    margin: 0 0 8px 0;
  }

  .sale-section__hero-subtitle {
    font-size: 24px;
    line-height: 1.2;
    margin: 0 0 12px 0;
  }

  .sale-section__hero-description {
    font-size: 13px;
    line-height: 1.4;
    margin: 0 0 16px 0;
  }

  .sale-section__hero-button {
    padding: 8px 16px;
    font-size: 12px;
  }

  .sale-section__filter-trigger {
    padding: 10px 16px;
    font-size: 14px;
    margin-bottom: 16px;
  }

  .sale-section__filter-trigger svg {
    width: 18px;
    height: 18px;
  }

  .sale-section__products {
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
  }

  .sale-section__carousel-wrapper {
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
  }

  .sale-section__products-grid {
    padding-left: 5%;
    padding-right: calc(5% + 4px);
    padding-bottom: 4px;
    gap: 12px;
    width: 100%;
    box-sizing: border-box;
  }

  .sale-section__products-grid .product-card {
    flex: 0 0 90%;
    min-width: 90%;
    max-width: 90%;
    scroll-snap-align: center;
    box-shadow: 4px 4px 0px 0px var(--color-black);
  }


  .sale-section__franchise-button {
    padding: 10px 20px;
    font-size: 16px;
  }

  /* Smaller drawer on very small screens */
  .sale-section__filter-panel {
    max-width: 90%;
  }

  .sale-section__filter-drawer-header {
    padding: 14px;
  }

  .sale-section__filter-drawer-title {
    font-size: 16px;
  }

  .sale-section__filter-drawer-content {
    padding: 14px;
  }

  .sale-section__filter-group {
    padding-bottom: 16px;
    gap: 10px;
  }

  .sale-section__filter-title {
    font-size: 14px;
  }

  .sale-section__price-inputs {
    flex-wrap: wrap;
    gap: 6px;
  }

  .sale-section__price-input {
    width: 90px;
    padding: 8px 10px;
    font-size: 13px;
  }

  .sale-section__filter-checkbox-label {
    font-size: 13px;
  }

  .sale-section__filter-drawer-footer {
    padding: 14px;
    gap: 8px;
    flex-direction: column;
  }

  .sale-section__filter-apply,
  .sale-section__filter-clear {
    width: 100%;
    padding: 12px 16px;
    font-size: 14px;
  }
}

@media screen and (max-width: 400px) {
  .sale-section__container {
    padding: 0 8px;
  }

  .sale-section__hero {
    padding: 0 8px;
    margin-bottom: 16px;
  }

  .sale-section__hero-container {
    border-radius: 4px;
  }

  .sale-section__hero-image {
    height: 200px;
  }

  .sale-section__hero-content {
    padding: 12px 8px;
  }

  .sale-section__hero-label {
    font-size: 11px;
    margin: 0 0 8px 0;
  }

  .sale-section__hero-title {
    font-size: 18px;
    margin: 0 0 6px 0;
  }

  .sale-section__hero-subtitle {
    font-size: 20px;
    margin: 0 0 8px 0;
  }

  .sale-section__hero-description {
    font-size: 12px;
    margin: 0 0 12px 0;
  }

  .sale-section__hero-button {
    padding: 8px 14px;
    font-size: 11px;
  }

  .sale-section__filter-trigger {
    padding: 8px 12px;
    font-size: 13px;
    margin-bottom: 12px;
  }

  .sale-section__products-grid {
    padding-left: 3%;
    padding-right: calc(3% + 4px);
    gap: 10px;
  }

  .sale-section__products-grid .product-card {
    flex: 0 0 94%;
    min-width: 94%;
    max-width: 94%;
  }


  .sale-section__franchise-button {
    padding: 8px 16px;
    font-size: 14px;
  }
}
{% endstylesheet %}

<script>
(function() {
  // Wait for DOM to be ready
  function initSaleSection() {
    const saleSection = document.querySelector('[id^="sale-"]');
    if (!saleSection) {
      // Retry if element not found (might be loading)
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initSaleSection);
        return;
      }
      console.warn('Sale section not found');
      return;
    }

    // Mobile Filter Drawer Elements
    const filterDrawer = saleSection.querySelector('[data-filter-drawer]');
    const filterDrawerTrigger = saleSection.querySelector('[data-filter-drawer-trigger]');
    const filterDrawerClose = saleSection.querySelector('[data-filter-drawer-close]');
    const filterOverlay = saleSection.querySelector('[data-filter-overlay]');
    const filterPanel = saleSection.querySelector('[data-filter-panel]');

    // Body scroll lock helper
    function lockBodyScroll() {
      document.body.style.overflow = 'hidden';
    }

    function unlockBodyScroll() {
      document.body.style.overflow = '';
    }

    // Drawer open/close functions
    function openDrawer(e) {
      if (e) {
        e.preventDefault();
        e.stopPropagation();
      }
      if (!filterDrawer) {
        console.warn('Filter drawer not found');
        return;
      }
      filterDrawer.setAttribute('aria-hidden', 'false');
      document.body.classList.add('drawer-open');
      lockBodyScroll();
      // Force reflow to ensure transition works
      void filterDrawer.offsetWidth;
    }

    function closeDrawer(e) {
      if (e) {
        e.preventDefault();
        e.stopPropagation();
      }
      if (!filterDrawer) return;
      filterDrawer.setAttribute('aria-hidden', 'true');
      document.body.classList.remove('drawer-open');
      unlockBodyScroll();
    }

    // Drawer event listeners
    if (filterDrawerTrigger) {
      // Direct event listener
      filterDrawerTrigger.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        openDrawer(e);
        
        // Sync drawer prices when opening
        setTimeout(() => {
          if (priceMinInput && priceMinInputDrawer) {
            priceMinInputDrawer.value = priceMinInput.value;
          }
          if (priceMaxInput && priceMaxInputDrawer) {
            priceMaxInputDrawer.value = priceMaxInput.value;
          }
          if (priceMinSlider && priceMinSliderDrawer) {
            priceMinSliderDrawer.value = priceMinSlider.value;
          }
          if (priceMaxSlider && priceMaxSliderDrawer) {
            priceMaxSliderDrawer.value = priceMaxSlider.value;
          }
        }, 100);
      });
      console.log('Filter drawer trigger button found and listener attached');
    } else {
      console.warn('Filter drawer trigger button not found initially');
    }

    if (filterDrawerClose) {
      filterDrawerClose.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        closeDrawer(e);
      });
    }

    if (filterOverlay) {
      filterOverlay.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        closeDrawer(e);
      });
    }

    // Escape key to close drawer
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && filterDrawer && filterDrawer.getAttribute('aria-hidden') === 'false') {
        e.preventDefault();
        closeDrawer();
      }
    });

    // Prevent body scroll when drawer is open
    document.body.classList.remove('drawer-open');

    // Filter toggle functionality (works for both desktop and drawer)
    function initializeFilterToggles() {
      const filterToggles = saleSection.querySelectorAll('[data-filter-toggle]');
      for (const toggle of filterToggles) {
        // Initialize aria-expanded if not set
        if (!toggle.hasAttribute('aria-expanded')) {
          const filterType = toggle.getAttribute('data-filter-toggle');
          const content = saleSection.querySelector(`[data-filter-content="${filterType}"]`);
          if (content) {
            toggle.setAttribute('aria-expanded', content.hidden ? 'false' : 'true');
          }
        }

        toggle.addEventListener('click', function() {
          const filterType = this.getAttribute('data-filter-toggle');
          const content = saleSection.querySelector(`[data-filter-content="${filterType}"]`);
          if (!content) return;

          const isExpanded = this.getAttribute('aria-expanded') === 'true';
          this.setAttribute('aria-expanded', !isExpanded);
          content.hidden = isExpanded;
        });
      }
    }

    initializeFilterToggles();

    // Mobile filters toggle (desktop collapse)
    const filtersToggle = saleSection.querySelector('[data-filters-toggle]');
    const filters = saleSection.querySelector('[data-sale-filters]');
    if (filtersToggle && filters) {
      filtersToggle.addEventListener('click', function() {
        const isCollapsed = filters.getAttribute('data-filters-collapsed') === 'true';
        filters.setAttribute('data-filters-collapsed', !isCollapsed);
        this.setAttribute('aria-expanded', isCollapsed);
      });
    }

    // Price range sliders and inputs (desktop)
    const priceMinInput = saleSection.querySelector('[data-price-min]');
    const priceMaxInput = saleSection.querySelector('[data-price-max]');
    const priceMinSlider = saleSection.querySelector('[data-slider-min]');
    const priceMaxSlider = saleSection.querySelector('[data-slider-max]');

    // Price range sliders and inputs (drawer)
    const priceMinInputDrawer = saleSection.querySelector('[data-price-min-drawer]');
    const priceMaxInputDrawer = saleSection.querySelector('[data-price-max-drawer]');
    const priceMinSliderDrawer = saleSection.querySelector('[data-slider-min-drawer]');
    const priceMaxSliderDrawer = saleSection.querySelector('[data-slider-max-drawer]');
    
    // Format price for display
    function formatPrice(value) {
      return '₹' + parseInt(value).toLocaleString('en-IN');
    }

    // Parse price from display format
    function parsePrice(value) {
      if (typeof value === 'string') {
        return parseInt(value.replace(/[₹,]/g, '')) || 0;
      }
      return parseInt(value) || 0;
    }

    // Sync price between desktop and drawer
    function syncPriceInputs(sourceInput, targetInput, sourceSlider, targetSlider) {
      if (sourceInput && targetInput) {
        targetInput.value = sourceInput.value;
      }
      if (sourceSlider && targetSlider) {
        targetSlider.value = sourceSlider.value;
      }
    }

    // Update price inputs from sliders
    function updatePriceInputs(slider, input, isDrawer = false) {
    if (!slider || !input) return;
    const value = parseInt(slider.value);
    input.value = formatPrice(value);
    
    // Sync with other side
    if (isDrawer) {
      if (priceMinInput && slider === priceMinSliderDrawer) {
        priceMinInput.value = formatPrice(value);
        if (priceMinSlider) priceMinSlider.value = value;
      }
      if (priceMaxInput && slider === priceMaxSliderDrawer) {
        priceMaxInput.value = formatPrice(value);
        if (priceMaxSlider) priceMaxSlider.value = value;
      }
    } else {
      if (priceMinInputDrawer && slider === priceMinSlider) {
        priceMinInputDrawer.value = formatPrice(value);
        if (priceMinSliderDrawer) priceMinSliderDrawer.value = value;
      }
      if (priceMaxInputDrawer && slider === priceMaxSlider) {
        priceMaxInputDrawer.value = formatPrice(value);
        if (priceMaxSliderDrawer) priceMaxSliderDrawer.value = value;
      }
    }
  }

  // Update sliders from inputs
  function updatePriceSliders(input, slider, isDrawer = false) {
    if (!input || !slider) return;
    const value = parsePrice(input.value) || 0;
    const maxValue = parseInt(slider.max) || 100000;
    slider.value = Math.min(value, maxValue);
    input.value = formatPrice(slider.value);
    
    // Sync with other side
    if (isDrawer) {
      if (priceMinInput && input === priceMinInputDrawer) {
        priceMinInput.value = formatPrice(slider.value);
        if (priceMinSlider) priceMinSlider.value = slider.value;
      }
      if (priceMaxInput && input === priceMaxInputDrawer) {
        priceMaxInput.value = formatPrice(slider.value);
        if (priceMaxSlider) priceMaxSlider.value = slider.value;
      }
    } else {
      if (priceMinInputDrawer && input === priceMinInput) {
        priceMinInputDrawer.value = formatPrice(slider.value);
        if (priceMinSliderDrawer) priceMinSliderDrawer.value = slider.value;
      }
      if (priceMaxInputDrawer && input === priceMaxInput) {
        priceMaxInputDrawer.value = formatPrice(slider.value);
        if (priceMaxSliderDrawer) priceMaxSliderDrawer.value = slider.value;
      }
    }
  }

  // Desktop price sliders
  if (priceMinSlider) {
    priceMinSlider.addEventListener('input', () => {
      updatePriceInputs(priceMinSlider, priceMinInput, false);
    });
  }

  if (priceMaxSlider) {
    priceMaxSlider.addEventListener('input', () => {
      updatePriceInputs(priceMaxSlider, priceMaxInput, false);
    });
  }

  if (priceMinInput) {
    priceMinInput.addEventListener('blur', () => {
      updatePriceSliders(priceMinInput, priceMinSlider, false);
    });
  }

  if (priceMaxInput) {
    priceMaxInput.addEventListener('blur', () => {
      updatePriceSliders(priceMaxInput, priceMaxSlider, false);
    });
  }

  // Drawer price sliders
  if (priceMinSliderDrawer) {
    priceMinSliderDrawer.addEventListener('input', () => {
      updatePriceInputs(priceMinSliderDrawer, priceMinInputDrawer, true);
    });
  }

  if (priceMaxSliderDrawer) {
    priceMaxSliderDrawer.addEventListener('input', () => {
      updatePriceInputs(priceMaxSliderDrawer, priceMaxInputDrawer, true);
    });
  }

  if (priceMinInputDrawer) {
    priceMinInputDrawer.addEventListener('blur', () => {
      updatePriceSliders(priceMinInputDrawer, priceMinSliderDrawer, true);
    });
  }

  if (priceMaxInputDrawer) {
    priceMaxInputDrawer.addEventListener('blur', () => {
      updatePriceSliders(priceMaxInputDrawer, priceMaxSliderDrawer, true);
    });
  }

  // Initialize price inputs
  if (priceMinSlider && priceMinInput) {
    updatePriceInputs(priceMinSlider, priceMinInput, false);
  }
  if (priceMaxSlider && priceMaxInput) {
    updatePriceInputs(priceMaxSlider, priceMaxInput, false);
  }

  // Price syncing is now handled in the openDrawer function above

  // Sync checkboxes between desktop and drawer
  function syncCheckboxes() {
    const categoryCheckboxes = saleSection.querySelectorAll('[data-filter-category]');
    const categoryCheckboxesDrawer = saleSection.querySelectorAll('[data-filter-category-drawer]');
    const brandCheckboxes = saleSection.querySelectorAll('[data-filter-brand]');
    const brandCheckboxesDrawer = saleSection.querySelectorAll('[data-filter-brand-drawer]');

    // Sync category checkboxes
    categoryCheckboxes.forEach((cb, index) => {
      const drawerCb = categoryCheckboxesDrawer[index];
      if (drawerCb) {
        cb.addEventListener('change', () => {
          drawerCb.checked = cb.checked;
        });
        drawerCb.addEventListener('change', () => {
          cb.checked = drawerCb.checked;
        });
      }
    });

    // Sync brand checkboxes
    brandCheckboxes.forEach((cb, index) => {
      const drawerCb = brandCheckboxesDrawer[index];
      if (drawerCb) {
        cb.addEventListener('change', () => {
          drawerCb.checked = cb.checked;
        });
        drawerCb.addEventListener('change', () => {
          cb.checked = drawerCb.checked;
        });
      }
    });
  }

  syncCheckboxes();

  // Filter products (basic implementation)
  const categoryCheckboxes = saleSection.querySelectorAll('[data-filter-category], [data-filter-category-drawer]');
  const brandCheckboxes = saleSection.querySelectorAll('[data-filter-brand], [data-filter-brand-drawer]');
  const productsGrid = saleSection.querySelector('[data-products-grid]');

  const filterProducts = () => {
    if (!productsGrid) return;

    const selectedCategories = Array.from(categoryCheckboxes)
      .filter(cb => cb.checked)
      .map(cb => cb.value.toLowerCase());

    const selectedBrands = Array.from(brandCheckboxes)
      .filter(cb => cb.checked)
      .map(cb => cb.value.toLowerCase());

    const productCards = productsGrid.querySelectorAll('.product-card');
    
    for (const card of productCards) {
      let show = true;

      // Basic filtering - can be enhanced with actual product data attributes
      if (selectedCategories.length > 0 || selectedBrands.length > 0) {
        // This is a placeholder - in a real implementation, you'd check product data attributes
        // or make an AJAX request to filter products
        show = true;
      }

      card.style.display = show ? '' : 'none';
    }
  };

  for (const checkbox of [...categoryCheckboxes, ...brandCheckboxes]) {
    checkbox.addEventListener('change', filterProducts);
  }

  // Apply filters button
  const filterApply = saleSection.querySelector('[data-filter-apply]');
  if (filterApply) {
    filterApply.addEventListener('click', () => {
      filterProducts();
      closeDrawer();
    });
  }

  // Clear all filters button
  const filterClear = saleSection.querySelector('[data-filter-clear]');
  if (filterClear) {
    filterClear.addEventListener('click', () => {
      // Clear all checkboxes
      [...categoryCheckboxes, ...brandCheckboxes].forEach(cb => {
        cb.checked = false;
      });
      
      // Reset price sliders
      if (priceMinSlider) priceMinSlider.value = 0;
      if (priceMaxSlider) priceMaxSlider.value = 100000;
      if (priceMinSliderDrawer) priceMinSliderDrawer.value = 0;
      if (priceMaxSliderDrawer) priceMaxSliderDrawer.value = 100000;
      
      // Reset price inputs
      if (priceMinInput) updatePriceInputs(priceMinSlider, priceMinInput, false);
      if (priceMaxInput) updatePriceInputs(priceMaxSlider, priceMaxInput, false);
      if (priceMinInputDrawer) updatePriceInputs(priceMinSliderDrawer, priceMinInputDrawer, true);
      if (priceMaxInputDrawer) updatePriceInputs(priceMaxSliderDrawer, priceMaxInputDrawer, true);
      
      filterProducts();
    });
  }
  } // End of initSaleSection function

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initSaleSection);
  } else {
    // DOM already loaded, but wait a tick to ensure all elements are rendered
    setTimeout(initSaleSection, 0);
  }
})();
</script>

{% schema %}
{
  "name": "Sale",
  "tag": "section",
  "class": "sale-section",
  "settings": [
    {
      "type": "header",
      "content": "Hero Banner"
    },
    {
      "type": "image_picker",
      "id": "hero_image",
      "label": "Hero Image"
    },
    {
      "type": "text",
      "id": "hero_title",
      "label": "Hero Title",
      "default": "Tech Mega Sale"
    },
    {
      "type": "text",
      "id": "hero_subtitle",
      "label": "Hero Subtitle",
      "default": "Upgrade Your Gear"
    },
    {
      "type": "textarea",
      "id": "hero_description",
      "label": "Hero Description",
      "default": "Save up to 40% on premium tech gear"
    },
    {
      "type": "text",
      "id": "hero_button_text",
      "label": "Button Text",
      "default": "Browse Gadgets"
    },
    {
      "type": "url",
      "id": "hero_button_url",
      "label": "Button URL"
    },
    {
      "type": "header",
      "content": "Products"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection",
      "info": "Products from this collection will be displayed"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "label": "Products to Show",
      "min": 4,
      "max": 24,
      "step": 4,
      "default": 12
    },
    {
      "type": "header",
      "content": "Franchise Button"
    },
    {
      "type": "checkbox",
      "id": "show_franchise_button",
      "label": "Show Franchise Button",
      "default": true
    },
    {
      "type": "text",
      "id": "franchise_text",
      "label": "Button Text",
      "default": "Join Franchise"
    },
    {
      "type": "url",
      "id": "franchise_url",
      "label": "Button URL"
    }
  ],
  "blocks": [
    {
      "type": "category",
      "name": "Category Filter",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Category Label",
          "default": "All devices"
        },
        {
          "type": "text",
          "id": "value",
          "label": "Category Value",
          "info": "Optional: Custom value for filtering. If empty, label will be used."
        }
      ]
    },
    {
      "type": "brand",
      "name": "Brand Filter",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Brand Label",
          "default": "Brand"
        },
        {
          "type": "text",
          "id": "value",
          "label": "Brand Value",
          "info": "Optional: Custom value for filtering. If empty, label will be used."
        },
        {
          "type": "text",
          "id": "count",
          "label": "Product Count",
          "info": "Optional: Number of products for this brand (e.g., 56)"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Sale",
      "settings": {
        "hero_title": "Tech Mega Sale",
        "hero_subtitle": "Upgrade Your Gear",
        "hero_description": "Save up to 40% on premium tech gear",
        "hero_button_text": "Browse Gadgets",
        "products_to_show": 12,
        "show_franchise_button": true,
        "franchise_text": "Join Franchise"
      },
      "blocks": [
        {
          "type": "category",
          "settings": {
            "label": "All devices"
          }
        },
        {
          "type": "category",
          "settings": {
            "label": "Mobile & Tablets"
          }
        },
        {
          "type": "category",
          "settings": {
            "label": "Laptops"
          }
        },
        {
          "type": "category",
          "settings": {
            "label": "Television"
          }
        },
        {
          "type": "category",
          "settings": {
            "label": "Headphones"
          }
        },
        {
          "type": "brand",
          "settings": {
            "label": "Lenovo",
            "count": "56"
          }
        },
        {
          "type": "brand",
          "settings": {
            "label": "Asus",
            "count": "32"
          }
        },
        {
          "type": "brand",
          "settings": {
            "label": "HP",
            "count": "185"
          }
        },
        {
          "type": "brand",
          "settings": {
            "label": "Macbook",
            "count": "75"
          }
        }
      ]
    }
  ]
}
{% endschema %}
